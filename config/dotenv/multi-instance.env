# TAS-73: Multi-Instance Deployment Configuration
# This file is used when running multiple orchestration/worker instances locally
# for testing horizontal scaling, race conditions, and concurrent processing.
#
# Usage:
#   source config/dotenv/multi-instance.env
#   cargo make cluster-start
#
# Or set these in your .env and run:
#   TASKER_ORCHESTRATION_INSTANCES=3 cargo make cluster-start-orchestration

# =============================================================================
# Multi-Instance Mode Settings
# =============================================================================

# Enable multi-instance mode (changes port allocation strategy)
TASKER_MULTI_INSTANCE_MODE=true

# Number of instances to start for each service type
TASKER_ORCHESTRATION_INSTANCES=2
TASKER_WORKER_RUST_INSTANCES=2
TASKER_WORKER_RUBY_INSTANCES=0
TASKER_WORKER_PYTHON_INSTANCES=0
TASKER_WORKER_TS_INSTANCES=0

# =============================================================================
# Port Allocation
# =============================================================================
# Each service type gets a port range. Instance N uses BASE_PORT + (N - 1).
#
# Orchestration: 8080-8089 (up to 10 instances)
# Rust Workers:  8100-8109
# Ruby Workers:  8200-8209
# Python Workers: 8300-8309
# TS Workers:    8400-8409

TASKER_ORCHESTRATION_BASE_PORT=8080
TASKER_WORKER_RUST_BASE_PORT=8100
TASKER_WORKER_RUBY_BASE_PORT=8200
TASKER_WORKER_PYTHON_BASE_PORT=8300
TASKER_WORKER_TS_BASE_PORT=8400

# =============================================================================
# Test Configuration
# =============================================================================
# Comma-separated list of orchestration URLs for test infrastructure

# For 2 orchestration instances:
TASKER_TEST_ORCHESTRATION_URLS=http://localhost:8080,http://localhost:8081

# For 2 rust worker instances:
TASKER_TEST_WORKER_URLS=http://localhost:8100,http://localhost:8101
