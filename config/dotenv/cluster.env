# TAS-73: Cluster Environment Configuration
# Layered on top of test.env when running multi-instance cluster tests.
#
# Usage:
#   cargo make setup-env-cluster       # Creates .env with cluster config
#   cargo make setup-env-cluster-split # Creates .env with cluster + split-db
#
# Or manually:
#   source config/dotenv/cluster.env
#   cargo make cluster-start

# =============================================================================
# Multi-Instance Mode Settings
# =============================================================================

# Enable multi-instance mode (changes port allocation strategy)
TASKER_MULTI_INSTANCE_MODE=true

# Number of instances to start for each service type
TASKER_ORCHESTRATION_INSTANCES=2
TASKER_WORKER_RUST_INSTANCES=2
TASKER_WORKER_RUBY_INSTANCES=2
TASKER_WORKER_PYTHON_INSTANCES=2
TASKER_WORKER_TS_INSTANCES=2

# =============================================================================
# Port Allocation
# =============================================================================
# Each service type gets a port range. Instance N uses BASE_PORT + (N - 1).
#
# REST API Ports:
#   Orchestration: 8080-8089 (up to 10 instances)
#   Rust Workers:  8100-8109
#   Ruby Workers:  8200-8209
#   Python Workers: 8300-8309
#   TS Workers:    8400-8409
#
# TAS-177: gRPC API Ports:
#   Orchestration gRPC: 9090-9099
#   Rust Worker gRPC:   9100-9109

TASKER_ORCHESTRATION_BASE_PORT=8080
TASKER_ORCHESTRATION_GRPC_BASE_PORT=9090
TASKER_WORKER_RUST_BASE_PORT=8100
TASKER_WORKER_RUST_GRPC_BASE_PORT=9100
TASKER_WORKER_RUBY_BASE_PORT=8200
TASKER_WORKER_RUBY_GRPC_BASE_PORT=9200
TASKER_WORKER_PYTHON_BASE_PORT=8300
TASKER_WORKER_PYTHON_GRPC_BASE_PORT=9300
TASKER_WORKER_TS_BASE_PORT=8400
TASKER_WORKER_TS_GRPC_BASE_PORT=9400

# =============================================================================
# Test Configuration - REST API
# =============================================================================
# Comma-separated list of orchestration URLs for test infrastructure

# For 2 orchestration instances:
TASKER_TEST_ORCHESTRATION_URLS=http://localhost:8080,http://localhost:8081

# Worker URLs by type (2 instances each):
TASKER_TEST_WORKER_RUST_URLS=http://localhost:8100,http://localhost:8101
TASKER_TEST_WORKER_RUBY_URLS=http://localhost:8200,http://localhost:8201
TASKER_TEST_WORKER_PYTHON_URLS=http://localhost:8300,http://localhost:8301
TASKER_TEST_WORKER_TS_URLS=http://localhost:8400,http://localhost:8401

# All worker URLs (for round-robin testing across all worker types):
TASKER_TEST_WORKER_URLS=http://localhost:8100,http://localhost:8101,http://localhost:8200,http://localhost:8201,http://localhost:8300,http://localhost:8301,http://localhost:8400,http://localhost:8401

# =============================================================================
# Test Configuration - gRPC API (TAS-177)
# =============================================================================
# gRPC endpoints for orchestration and workers

# For 2 orchestration gRPC instances:
TASKER_TEST_ORCHESTRATION_GRPC_URLS=http://localhost:9090,http://localhost:9091

# For 2 Rust worker gRPC instances:
TASKER_TEST_WORKER_RUST_GRPC_URLS=http://localhost:9100,http://localhost:9101

# For 2 Ruby worker gRPC instances:
TASKER_TEST_WORKER_RUBY_GRPC_URLS=http://localhost:9200,http://localhost:9201

# For 2 Python worker gRPC instances:
TASKER_TEST_WORKER_PYTHON_GRPC_URLS=http://localhost:9300,http://localhost:9301

# For 2 TypeScript worker gRPC instances:
TASKER_TEST_WORKER_TS_GRPC_URLS=http://localhost:9400,http://localhost:9401

# =============================================================================
# Single-Instance Test Compatibility
# =============================================================================
# These singular variables are used by IntegrationTestManager for backward
# compatibility with tests written for single-instance mode.

TASKER_TEST_ORCHESTRATION_URL=http://localhost:8080
TASKER_TEST_ORCHESTRATION_GRPC_URL=http://localhost:9090
TASKER_TEST_WORKER_URL=http://localhost:8100
TASKER_TEST_RUST_WORKER_GRPC_URL=http://localhost:9100
TASKER_TEST_RUBY_WORKER_URL=http://localhost:8200
TASKER_TEST_RUBY_WORKER_GRPC_URL=http://localhost:9200
TASKER_TEST_PYTHON_WORKER_URL=http://localhost:8300
TASKER_TEST_PYTHON_WORKER_GRPC_URL=http://localhost:9300
TASKER_TEST_TS_WORKER_URL=http://localhost:8400
TASKER_TEST_TS_WORKER_GRPC_URL=http://localhost:9400
