# TAS-73: Cluster Environment Configuration
# Layered on top of test.env when running multi-instance cluster tests.
#
# Usage:
#   cargo make setup-env-cluster       # Creates .env with cluster config
#   cargo make setup-env-cluster-split # Creates .env with cluster + split-db
#
# Or manually:
#   source config/dotenv/cluster.env
#   cargo make cluster-start

# =============================================================================
# Multi-Instance Mode Settings
# =============================================================================

# Enable multi-instance mode (changes port allocation strategy)
TASKER_MULTI_INSTANCE_MODE=true

# Number of instances to start for each service type
TASKER_ORCHESTRATION_INSTANCES=2
TASKER_WORKER_RUST_INSTANCES=2
TASKER_WORKER_RUBY_INSTANCES=2
TASKER_WORKER_PYTHON_INSTANCES=2
TASKER_WORKER_TS_INSTANCES=2

# =============================================================================
# Port Allocation
# =============================================================================
# Each service type gets a port range. Instance N uses BASE_PORT + (N - 1).
#
# Orchestration: 8080-8089 (up to 10 instances)
# Rust Workers:  8100-8109
# Ruby Workers:  8200-8209
# Python Workers: 8300-8309
# TS Workers:    8400-8409

TASKER_ORCHESTRATION_BASE_PORT=8080
TASKER_WORKER_RUST_BASE_PORT=8100
TASKER_WORKER_RUBY_BASE_PORT=8200
TASKER_WORKER_PYTHON_BASE_PORT=8300
TASKER_WORKER_TS_BASE_PORT=8400

# =============================================================================
# Test Configuration
# =============================================================================
# Comma-separated list of orchestration URLs for test infrastructure

# For 2 orchestration instances:
TASKER_TEST_ORCHESTRATION_URLS=http://localhost:8080,http://localhost:8081

# Worker URLs by type (2 instances each):
TASKER_TEST_WORKER_RUST_URLS=http://localhost:8100,http://localhost:8101
TASKER_TEST_WORKER_RUBY_URLS=http://localhost:8200,http://localhost:8201
TASKER_TEST_WORKER_PYTHON_URLS=http://localhost:8300,http://localhost:8301
TASKER_TEST_WORKER_TS_URLS=http://localhost:8400,http://localhost:8401

# All worker URLs (for round-robin testing across all worker types):
TASKER_TEST_WORKER_URLS=http://localhost:8100,http://localhost:8101,http://localhost:8200,http://localhost:8201,http://localhost:8300,http://localhost:8301,http://localhost:8400,http://localhost:8401

# =============================================================================
# Single-Instance Test Compatibility
# =============================================================================
# These singular variables are used by IntegrationTestManager for backward
# compatibility with tests written for single-instance mode.

TASKER_TEST_ORCHESTRATION_URL=http://localhost:8080
TASKER_TEST_WORKER_URL=http://localhost:8100
TASKER_TEST_RUBY_WORKER_URL=http://localhost:8200
TASKER_TEST_PYTHON_WORKER_URL=http://localhost:8300
TASKER_TEST_TS_WORKER_URL=http://localhost:8400
