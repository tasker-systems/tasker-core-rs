# Override environment for test
environment = "test"

[common.database]
# Test database connection
database = "tasker_rust_test"
url = "${DATABASE_URL:-postgresql://tasker:tasker@localhost:5432/tasker_rust_test}"


[common.database.pool]
# Smaller pool for tests
max_connections = 10
min_connections = 2
acquire_timeout_seconds = 5
idle_timeout_seconds = 60


[common.queues]
# Faster polling for tests
default_batch_size = 5


[common.queues.pgmq]
max_retries = 1  # Fewer retries in tests

# Smaller channel buffers for tests (TAS-51)

[common.mpsc_channels.event_publisher]
event_queue_buffer_size = 100


[common.mpsc_channels.ffi]
ruby_event_buffer_size = 100

# Test circuit breaker settings - faster failure detection

[common.circuit_breakers.global_settings]
max_circuit_breakers = 20
metrics_collection_interval_seconds = 10


[common.circuit_breakers.default_config]
failure_threshold = 3  # Fail faster in tests
timeout_seconds = 5  # Shorter recovery timeout
success_threshold = 1  # Single success to close

# Test-specific telemetry settings
[common.telemetry]
enabled = false  # Disable telemetry in tests

# Test-specific execution settings
[common.execution]
environment = "test"
# Smaller concurrency limits for test environments
max_concurrent_tasks = 10
max_concurrent_steps = 50
# Shorter timeouts for faster test failures
default_timeout_seconds = 60
step_execution_timeout_seconds = 30

# Test-specific decision points settings
[common.decision_points]
max_steps_per_decision = 10  # Lower limit for test safety
max_decision_depth = 5  # Shallow nesting for simple tests
warn_threshold_steps = 5  # Low threshold to catch issues early
warn_threshold_depth = 3
enable_detailed_logging = true  # Detailed logging helps diagnose test failures
enable_metrics = false  # Metrics add overhead in tests
