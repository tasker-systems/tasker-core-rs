# Tasker Configuration - complete Context
# Environment: production
# Generated: 2025-12-11T11:48:21.080616+00:00
# Source: config/tasker
#
# This file is a MERGED configuration (base + environment overrides).
# DO NOT EDIT manually - regenerate using: tasker-cli config generate
#
# Environment Variable Overrides (applied at runtime):
# - DATABASE_URL: Override database.url (K8s secrets rotation)
# - TASKER_TEMPLATE_PATH: Override worker.template_path (testing)
# - TASKER_WEB_BIND_ADDRESS: Override web bind address (CI/testing port isolation)
#

[common.backoff]
backoff_multiplier = 2.0
default_backoff_seconds = [
    1,
    5,
    15,
    30,
    60,
]
jitter_enabled = true
jitter_max_percentage = 0.15
max_backoff_seconds = 3600

[common.backoff.reenqueue_delays]
blocked_by_failures = 120
enqueuing_steps = 5
evaluating_results = 10
initializing = 10
steps_in_process = 15
waiting_for_dependencies = 60
waiting_for_retry = 30

[common.circuit_breakers]
enabled = true

[common.circuit_breakers.component_configs.pgmq]
failure_threshold = 5
success_threshold = 2
timeout_seconds = 30

[common.circuit_breakers.component_configs.task_readiness]
failure_threshold = 10
success_threshold = 3
timeout_seconds = 60

[common.circuit_breakers.default_config]
failure_threshold = 5
success_threshold = 2
timeout_seconds = 30

[common.circuit_breakers.global_settings]
max_circuit_breakers = 50
metrics_collection_interval_seconds = 30
min_state_transition_interval_seconds = 5.0

[common.database]
database = "tasker_development"
skip_migration_check = false
url = "${DATABASE_URL:-postgresql://localhost/tasker}"

[common.database.pool]
acquire_timeout_seconds = 10
idle_timeout_seconds = 300
max_connections = 50
max_lifetime_seconds = 1800
min_connections = 10

[common.database.variables]
statement_timeout = 30000

[common.execution]
connection_timeout_seconds = 30
default_timeout_seconds = 3600
environment = "production"
max_concurrent_steps = 2000
max_concurrent_tasks = 200
max_discovery_attempts = 5
max_retries = 3
max_workflow_steps = 10000
step_batch_size = 50
step_execution_timeout_seconds = 600

[common.mpsc_channels.event_publisher]
event_queue_buffer_size = 5000

[common.mpsc_channels.ffi]
ruby_event_buffer_size = 1000

[common.mpsc_channels.overflow_policy]
drop_policy = "block"
log_warning_threshold = 0.8

[common.mpsc_channels.overflow_policy.metrics]
enabled = true
saturation_check_interval_seconds = 30

[common.queues]
backend = "pgmq"
default_batch_size = 10
default_visibility_timeout_seconds = 30
health_check_interval = 60
max_batch_size = 100
naming_pattern = "{namespace}_{name}_queue"
orchestration_namespace = "orchestration"
worker_namespace = "worker"

[common.queues.orchestration_queues]
step_results = "orchestration_step_results"
task_finalizations = "orchestration_task_finalizations"
task_requests = "orchestration_task_requests"

[common.queues.pgmq]
max_retries = 3
poll_interval_ms = 500
shutdown_timeout_seconds = 10

[common.queues.pgmq.queue_depth_thresholds]
critical_threshold = 5000
overflow_threshold = 10000
warning_threshold = 1000

[common.queues.rabbitmq]
connection_timeout_seconds = 30

[common.system]
default_dependent_system = "default"
max_recursion_depth = 50
version = "0.1.0"

[common.task_templates]
search_paths = ["config/tasks/**/*.{yml,yaml}"]

[common.telemetry]
enabled = true
sample_rate = 0.01
service_name = "tasker-core"

[orchestration]
enable_performance_logging = true
mode = "standalone"

[orchestration.batch_processing]
checkpoint_interval_default = 200
checkpoint_stall_minutes = 30
default_batch_size = 2000
enabled = true
max_parallel_batches = 100

[orchestration.decision_points]
enable_detailed_logging = false
enable_metrics = true
enabled = true
max_decision_depth = 20
max_steps_per_decision = 100
warn_threshold_depth = 10
warn_threshold_steps = 50

[orchestration.dlq]
auto_dlq_on_staleness = true
enabled = true
include_full_task_snapshot = true
max_pending_age_hours = 168

[orchestration.dlq.reasons]
dependency_cycle_detected = true
manual_dlq = true
max_retries_exceeded = true
staleness_timeout = true
worker_unavailable = true

[orchestration.dlq.staleness_detection]
batch_size = 200
detection_interval_seconds = 600
dry_run = false
enabled = true

[orchestration.dlq.staleness_detection.actions]
auto_move_to_dlq = true
auto_transition_to_error = true
emit_events = true
event_channel = "task_staleness_detected"

[orchestration.dlq.staleness_detection.thresholds]
steps_in_process_minutes = 60
task_max_lifetime_hours = 48
waiting_for_dependencies_minutes = 120
waiting_for_retry_minutes = 60

[orchestration.event_systems.orchestration]
deployment_mode = "Hybrid"
system_id = "orchestration-event-system"

[orchestration.event_systems.orchestration.health]
enabled = true
error_rate_threshold_per_minute = 20
max_consecutive_errors = 10
performance_monitoring_enabled = true

[orchestration.event_systems.orchestration.processing]
batch_size = 20
max_concurrent_operations = 50
max_retries = 3

[orchestration.event_systems.orchestration.processing.backoff]
initial_delay_ms = 100
jitter_percent = 0.1
max_delay_ms = 10000
multiplier = 2.0

[orchestration.event_systems.orchestration.timing]
claim_timeout_seconds = 300
fallback_polling_interval_seconds = 5
health_check_interval_seconds = 30
processing_timeout_seconds = 60
visibility_timeout_seconds = 30

[orchestration.event_systems.task_readiness]
deployment_mode = "Hybrid"
system_id = "task-readiness-event-system"

[orchestration.event_systems.task_readiness.health]
enabled = true
error_rate_threshold_per_minute = 20
max_consecutive_errors = 10
performance_monitoring_enabled = true

[orchestration.event_systems.task_readiness.processing]
batch_size = 50
max_concurrent_operations = 100
max_retries = 3

[orchestration.event_systems.task_readiness.processing.backoff]
initial_delay_ms = 100
jitter_percent = 0.1
max_delay_ms = 10000
multiplier = 2.0

[orchestration.event_systems.task_readiness.timing]
claim_timeout_seconds = 300
fallback_polling_interval_seconds = 5
health_check_interval_seconds = 30
processing_timeout_seconds = 60
visibility_timeout_seconds = 30

[orchestration.mpsc_channels.command_processor]
command_buffer_size = 10000

[orchestration.mpsc_channels.event_listeners]
pgmq_event_buffer_size = 100000

[orchestration.mpsc_channels.event_systems]
event_channel_buffer_size = 20000

[orchestration.web]
bind_address = "${TASKER_WEB_BIND_ADDRESS:-0.0.0.0:8080}"
enabled = true
request_timeout_ms = 30000

[orchestration.web.auth]
api_key = ""
api_key_header = "X-API-Key"
enabled = false
jwt_audience = "tasker-api"
jwt_issuer = "tasker-core"
jwt_private_key = ""
jwt_public_key = ""
jwt_token_expiry_hours = 24

[[orchestration.web.auth.protected_routes]]
auth_type = "bearer"
method = "POST"
path = "/v1/tasks"
required = false

[[orchestration.web.auth.protected_routes]]
auth_type = "bearer"
method = "DELETE"
path = "/v1/tasks/{task_uuid}"
required = true

[[orchestration.web.auth.protected_routes]]
auth_type = "bearer"
method = "PATCH"
path = "/v1/tasks/{task_uuid}/workflow_steps/{step_uuid}"
required = true

[[orchestration.web.auth.protected_routes]]
auth_type = "bearer"
method = "GET"
path = "/v1/analytics/performance"
required = false

[[orchestration.web.auth.protected_routes]]
auth_type = "bearer"
method = "GET"
path = "/v1/analytics/bottlenecks"
required = false

[orchestration.web.database_pools]
max_total_connections_hint = 50
web_api_connection_timeout_seconds = 30
web_api_idle_timeout_seconds = 600
web_api_max_connections = 30
web_api_pool_size = 20

[orchestration.web.resilience]
circuit_breaker_enabled = true

[worker]
worker_id = "prod-worker-001"
worker_type = "general"

[worker.circuit_breakers.ffi_completion_send]
failure_threshold = 5
recovery_timeout_seconds = 5
slow_send_threshold_ms = 100
success_threshold = 2

[worker.event_systems.worker]
deployment_mode = "Hybrid"
system_id = "worker-event-system"

[worker.event_systems.worker.health]
enabled = true
error_rate_threshold_per_minute = 20
max_consecutive_errors = 10
performance_monitoring_enabled = true

[worker.event_systems.worker.metadata.fallback_poller]
age_threshold_seconds = 5
batch_size = 20
enabled = true
max_age_hours = 24
polling_interval_ms = 1000
supported_namespaces = []
visibility_timeout_seconds = 30

[worker.event_systems.worker.metadata.in_process_events]
deduplication_cache_size = 10000
ffi_integration_enabled = true

[worker.event_systems.worker.metadata.listener]
batch_processing = true
connection_timeout_seconds = 30
event_timeout_seconds = 60
max_retry_attempts = 5
retry_interval_seconds = 5

[worker.event_systems.worker.metadata.resource_limits]
max_cpu_percent = 80.0
max_database_connections = 100
max_memory_mb = 4096
max_queue_connections = 50

[worker.event_systems.worker.processing]
batch_size = 20
max_concurrent_operations = 100
max_retries = 3

[worker.event_systems.worker.processing.backoff]
initial_delay_ms = 100
jitter_percent = 0.1
max_delay_ms = 10000
multiplier = 2.0

[worker.event_systems.worker.timing]
claim_timeout_seconds = 300
fallback_polling_interval_seconds = 2
health_check_interval_seconds = 30
processing_timeout_seconds = 60
visibility_timeout_seconds = 30

[worker.health_monitoring]
error_rate_threshold = 0.05
health_check_interval_seconds = 30
performance_monitoring_enabled = true

[worker.mpsc_channels.command_processor]
command_buffer_size = 5000

[worker.mpsc_channels.domain_events]
command_buffer_size = 5000
log_dropped_events = false
shutdown_drain_timeout_ms = 10000

[worker.mpsc_channels.event_listeners]
pgmq_event_buffer_size = 10000

[worker.mpsc_channels.event_subscribers]
completion_buffer_size = 1000
result_buffer_size = 1000

[worker.mpsc_channels.event_systems]
event_channel_buffer_size = 5000

[worker.mpsc_channels.ffi_dispatch]
callback_timeout_ms = 10000
completion_send_timeout_ms = 10000
completion_timeout_ms = 60000
dispatch_buffer_size = 5000
starvation_warning_threshold_ms = 10000

[worker.mpsc_channels.handler_dispatch]
completion_buffer_size = 5000
dispatch_buffer_size = 5000
handler_timeout_ms = 60000
max_concurrent_handlers = 50

[worker.mpsc_channels.handler_dispatch.load_shedding]
capacity_threshold_percent = 80.0
enabled = true
warning_threshold_percent = 70.0

[worker.mpsc_channels.in_process_events]
broadcast_buffer_size = 5000
dispatch_timeout_ms = 10000
log_subscriber_errors = false

[worker.orchestration_client]
base_url = "http://orchestration:8080"
max_retries = 3
timeout_ms = 30000

[worker.step_processing]
claim_timeout_seconds = 300
max_concurrent_steps = 100
max_retries = 3

[worker.web]
bind_address = "${TASKER_WEB_BIND_ADDRESS:-0.0.0.0:8081}"
enabled = true
request_timeout_ms = 30000

[worker.web.auth]
api_key = ""
api_key_header = "X-API-Key"
enabled = false
jwt_audience = "worker-api"
jwt_issuer = "tasker-worker"
jwt_private_key = ""
jwt_public_key = ""
jwt_token_expiry_hours = 24

[[worker.web.auth.protected_routes]]
auth_type = "bearer"
method = "GET"
path = "/status/detailed"
required = false

[[worker.web.auth.protected_routes]]
auth_type = "bearer"
method = "GET"
path = "/handlers"
required = false

[[worker.web.auth.protected_routes]]
auth_type = "bearer"
method = "DELETE"
path = "/templates/cache"
required = true

[[worker.web.auth.protected_routes]]
auth_type = "bearer"
method = "POST"
path = "/templates/cache/maintain"
required = true

[[worker.web.auth.protected_routes]]
auth_type = "bearer"
method = "POST"
path = "/templates/{namespace}/{name}/{version}/refresh"
required = true

[worker.web.database_pools]
max_total_connections_hint = 25
web_api_connection_timeout_seconds = 30
web_api_idle_timeout_seconds = 600
web_api_max_connections = 15
web_api_pool_size = 10

[worker.web.resilience]
circuit_breaker_enabled = true
