[orchestration]
mode = "standalone"
max_concurrent_orchestrators = 3
enable_performance_logging = false
use_unified_state_machine = true

# Note: Queue configuration has been moved to config/tasker/base/queues.toml
# The orchestration system now references the centralized queue configuration

[orchestration.operational_state]
enable_shutdown_aware_monitoring = true
suppress_alerts_during_shutdown = true
startup_health_threshold_multiplier = 0.5
shutdown_health_threshold_multiplier = 0.0
graceful_shutdown_timeout_seconds = 30
emergency_shutdown_timeout_seconds = 5
enable_transition_logging = true
transition_log_level = "INFO"

[orchestration.web]
enabled = true
bind_address = "0.0.0.0:8080"
request_timeout_ms = 30000
max_request_size_mb = 16

[orchestration.web.tls]
enabled = false
cert_path = ""
key_path = ""
# For production, set these via environment variables:
# WEB_TLS_ENABLED=true
# WEB_TLS_CERT_PATH=/path/to/cert.pem
# WEB_TLS_KEY_PATH=/path/to/key.pem

[orchestration.web.database_pools]
# Web API dedicated pool configuration
# These pools are separate from orchestration pools to prevent resource contention
web_api_pool_size = 10
web_api_max_connections = 15
web_api_connection_timeout_seconds = 30
web_api_idle_timeout_seconds = 600
max_total_connections_hint = 45         # Should align with database server limits

[orchestration.web.cors]
enabled = true
allowed_origins = ["*"]
allowed_methods = ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
allowed_headers = ["*"]
max_age_seconds = 86400

[orchestration.web.auth]
enabled = false
jwt_issuer = "tasker-core"
jwt_audience = "tasker-api"
jwt_token_expiry_hours = 24
# JWT keys should be provided via environment variables for security:
# JWT_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----..."
# JWT_PUBLIC_KEY="-----BEGIN PUBLIC KEY-----..."
jwt_private_key = ""
jwt_public_key = ""
# API key for testing (use env var API_KEY in production)
api_key = ""
api_key_header = "X-API-Key"

# Route-specific authentication configuration
# Configure which routes require authentication and what type
[orchestration.web.auth.protected_routes]
# Mutation endpoints that should require JWT auth by default
"DELETE /v1/tasks/{task_uuid}" = { auth_type = "bearer", required = true }
"PATCH /v1/tasks/{task_uuid}/workflow_steps/{step_uuid}" = { auth_type = "bearer", required = true }

# Additional routes that can be configured to require auth
"POST /v1/tasks" = { auth_type = "bearer", required = false }
"GET /v1/analytics/performance" = { auth_type = "bearer", required = false }
"GET /v1/analytics/bottlenecks" = { auth_type = "bearer", required = false }

[orchestration.web.rate_limiting]
enabled = false
requests_per_minute = 1000
burst_size = 100
per_client_limit = true

[orchestration.web.resilience]
circuit_breaker_enabled = true
request_timeout_seconds = 30
max_concurrent_requests = 100

[orchestration.web.resource_monitoring]
# Integration with health monitoring system
report_pool_usage_to_health_monitor = true
pool_usage_warning_threshold = 0.75
pool_usage_critical_threshold = 0.90
