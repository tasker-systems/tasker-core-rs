# Test Environment - Worker Configuration Overrides

[worker]
worker_id = "test-worker-001"

# TAS-75: Circuit breakers - faster thresholds for testing
[worker.circuit_breakers.ffi_completion_send]
failure_threshold = 3
recovery_timeout_seconds = 1
success_threshold = 1
slow_send_threshold_ms = 50

[worker.event_systems.worker.timing]
fallback_polling_interval_seconds = 1

[worker.event_systems.worker.metadata.in_process_events]
deduplication_cache_size = 1000

[worker.event_systems.worker.metadata.fallback_poller]
polling_interval_ms = 500
age_threshold_seconds = 2
max_age_hours = 12

[worker.event_systems.worker.metadata.resource_limits]
max_memory_mb = 2048

[worker.step_processing]
max_concurrent_steps = 10

[worker.health_monitoring]
health_check_interval_seconds = 10

[worker.mpsc_channels.command_processor]
command_buffer_size = 100

[worker.mpsc_channels.event_systems]
event_channel_buffer_size = 100

[worker.mpsc_channels.event_subscribers]
completion_buffer_size = 100
result_buffer_size = 100

# TAS-65: In-process event bus - smaller buffers for testing
[worker.mpsc_channels.in_process_events]
broadcast_buffer_size = 1000
log_subscriber_errors = true
dispatch_timeout_ms = 2000

[worker.mpsc_channels.event_listeners]
pgmq_event_buffer_size = 100

# TAS-65/TAS-69: Domain Event System - smaller buffers for testing
[worker.mpsc_channels.domain_events]
command_buffer_size = 100
shutdown_drain_timeout_ms = 1000
log_dropped_events = true

# TAS-67: Handler Dispatch System - smaller buffers/faster timeouts for testing
[worker.mpsc_channels.handler_dispatch]
dispatch_buffer_size = 100
completion_buffer_size = 100
max_concurrent_handlers = 5
handler_timeout_ms = 5000

# TAS-67: FFI Dispatch Channel - smaller buffers/faster timeouts for testing
[worker.mpsc_channels.ffi_dispatch]
dispatch_buffer_size = 100
completion_timeout_ms = 5000
# TAS-67 Risk Mitigation: Fast timeout for tests
callback_timeout_ms = 2000

[worker.web]
# Increased from 5000ms to 30000ms to support complex operations
request_timeout_ms = 30000
# Enable config endpoint for debugging in test environment
config_endpoint_enabled = true

[worker.web.database_pools]
web_api_pool_size = 5
web_api_max_connections = 10
web_api_connection_timeout_seconds = 15
web_api_idle_timeout_seconds = 300
max_total_connections_hint = 15

# TAS-177: gRPC API - test environment overrides
[worker.grpc]
enabled = true
# Faster keepalive for testing
keepalive_interval_seconds = 10
keepalive_timeout_seconds = 5
