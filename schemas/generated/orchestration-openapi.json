{
  "openapi": "3.1.0",
  "info": {
    "title": "Tasker Web API",
    "description": "REST API for the Tasker workflow orchestration system",
    "contact": {
      "name": "Tasker Systems",
      "email": "support@tasker-systems.com"
    },
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    },
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "/",
      "description": "API version 1"
    }
  ],
  "paths": {
    "/config": {
      "get": {
        "tags": [
          "config"
        ],
        "summary": "Get orchestration configuration: GET /config",
        "description": "Returns operational configuration metadata safe for external consumption.\nOnly whitelisted fields are included — no secrets, keys, or credentials.\n\n**Required Permission:** `system:config_read`",
        "operationId": "get_config",
        "responses": {
          "200": {
            "description": "Orchestration configuration (safe fields only)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrchestrationConfigResponse"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "system:config_read"
      }
    },
    "/health": {
      "get": {
        "tags": [
          "health"
        ],
        "summary": "Basic health check endpoint: GET /health",
        "description": "Simple health check that returns OK if the service is running.\nThis endpoint is always available, even during graceful shutdown.",
        "operationId": "basic_health",
        "responses": {
          "200": {
            "description": "Service is running",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/health/detailed": {
      "get": {
        "tags": [
          "health"
        ],
        "summary": "Detailed health status: GET /health/detailed",
        "description": "Comprehensive health check with detailed information about all subsystems.\nMay require authentication depending on configuration.",
        "operationId": "detailed_health",
        "responses": {
          "200": {
            "description": "Detailed health information",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DetailedHealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/live": {
      "get": {
        "tags": [
          "health"
        ],
        "summary": "Kubernetes liveness probe: GET /live",
        "description": "Indicates whether the service is alive and should not be restarted.\nThis is a simpler check than readiness - mainly checks if the process is responsive.",
        "operationId": "liveness_probe",
        "responses": {
          "200": {
            "description": "Service is alive",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/ready": {
      "get": {
        "tags": [
          "health"
        ],
        "summary": "Kubernetes readiness probe: GET /ready",
        "description": "Indicates whether the service is ready to accept traffic.\nChecks database connectivity and circuit breaker status.",
        "operationId": "readiness_probe",
        "responses": {
          "200": {
            "description": "Service is ready",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReadinessResponse"
                }
              }
            }
          },
          "503": {
            "description": "Service is not ready",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        }
      }
    },
    "/v1/analytics/bottlenecks": {
      "get": {
        "tags": [
          "analytics"
        ],
        "summary": "Get bottleneck analysis: GET /v1/analytics/bottlenecks",
        "description": "**Required Permission:** `system:analytics_read`",
        "operationId": "get_bottlenecks",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of slow steps to return (default: 10)",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32"
            }
          },
          {
            "name": "min_executions",
            "in": "query",
            "description": "Minimum number of executions for inclusion (default: 5)",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Bottleneck analysis",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BottleneckAnalysis"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "503": {
            "description": "Service unavailable",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "system:analytics_read"
      }
    },
    "/v1/analytics/performance": {
      "get": {
        "tags": [
          "analytics"
        ],
        "summary": "Get performance metrics: GET /v1/analytics/performance",
        "description": "**Required Permission:** `system:analytics_read`",
        "operationId": "get_performance_metrics",
        "parameters": [
          {
            "name": "hours",
            "in": "query",
            "description": "Number of hours to look back (default: 24)",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Performance metrics",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PerformanceMetrics"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "503": {
            "description": "Service unavailable",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "system:analytics_read"
      }
    },
    "/v1/dlq": {
      "get": {
        "tags": [
          "dlq"
        ],
        "summary": "List DLQ entries: GET /v1/dlq",
        "description": "Returns a list of DLQ entries with optional filtering by resolution status.\nSupports pagination via limit/offset parameters.\n\n# Query Parameters\n\n- `resolution_status` - Filter by resolution status (optional)\n- `limit` - Maximum entries to return (default: 50)\n- `offset` - Pagination offset (default: 0)\n\n# Example\n\n```text\nGET /v1/dlq?resolution_status=pending&limit=20\n```\n\n**Required Permission:** `dlq:read`",
        "operationId": "list_dlq_entries",
        "parameters": [
          {
            "name": "resolution_status",
            "in": "query",
            "description": "Filter by resolution status (optional)",
            "required": false,
            "schema": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "$ref": "#/components/schemas/DlqResolutionStatus"
                }
              ]
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of entries to return (default: 50)",
            "required": false,
            "schema": {
              "type": [
                "integer",
                "null"
              ],
              "format": "int64"
            }
          },
          {
            "name": "offset",
            "in": "query",
            "description": "Offset for pagination (default: 0)",
            "required": false,
            "schema": {
              "type": [
                "integer",
                "null"
              ],
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of DLQ entries",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/DlqEntry"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "500": {
            "description": "Database error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "dlq:read"
      }
    },
    "/v1/dlq/entry/{dlq_entry_uuid}": {
      "patch": {
        "tags": [
          "dlq"
        ],
        "summary": "Update DLQ investigation status: PATCH /v1/dlq/entry/{dlq_entry_uuid}",
        "description": "Updates the investigation status and notes for a DLQ entry.\nThis endpoint tracks the INVESTIGATION workflow, not task resolution.\n\n**Note**: Task resolution happens via step APIs:\n`PATCH /v1/tasks/{uuid}/workflow_steps/{step_uuid}`\n\n# Path Parameters\n\n- `dlq_entry_uuid` - UUID of the DLQ entry\n\n# Request Body\n\n```json\n{\n  \"resolution_status\": \"manually_resolved\",\n  \"resolution_notes\": \"Fixed blocked step by recreating upstream dependency\",\n  \"resolved_by\": \"operator@example.com\"\n}\n```\n\n**Required Permission:** `dlq:update`",
        "operationId": "update_dlq_investigation",
        "parameters": [
          {
            "name": "dlq_entry_uuid",
            "in": "path",
            "description": "DLQ entry UUID",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateInvestigationRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Investigation updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UpdateInvestigationResponse"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "404": {
            "description": "DLQ entry not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "500": {
            "description": "Database error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "dlq:update"
      }
    },
    "/v1/dlq/investigation-queue": {
      "get": {
        "tags": [
          "dlq"
        ],
        "summary": "Get DLQ investigation queue: GET /v1/dlq/investigation-queue",
        "description": "Returns a prioritized queue of pending DLQ entries for operator triage.\nEntries are ordered by priority score (higher = more urgent) combining\nbase reason priority with age factor.\n\n# Query Parameters\n\n- `limit` - Maximum entries to return (default: 100)\n\n# Response\n\nReturns investigation queue entries including:\n- DLQ entry and task UUIDs\n- Original state and DLQ reason\n- Task metadata (namespace, name, current state)\n- Time in DLQ (minutes)\n- Priority score for triage ordering\n\n# Example\n\n```text\nGET /v1/dlq/investigation-queue?limit=50\n```\n\n**Required Permission:** `dlq:read`",
        "operationId": "get_investigation_queue",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum entries to return (default: 100)",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Prioritized investigation queue",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/DlqInvestigationQueueEntry"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "500": {
            "description": "Database error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "dlq:read"
      }
    },
    "/v1/dlq/staleness": {
      "get": {
        "tags": [
          "dlq"
        ],
        "summary": "Get task staleness monitoring: GET /v1/dlq/staleness",
        "description": "Returns real-time staleness monitoring for active tasks in waiting states.\nProvides proactive visibility into tasks approaching staleness thresholds,\nenabling prevention of DLQ entries through early intervention.\n\n# Query Parameters\n\n- `limit` - Maximum tasks to return (default: 100)\n\n# Response\n\nReturns staleness monitoring entries with:\n- Task UUID and metadata (namespace, name)\n- Current state and time in state\n- Staleness threshold and health status classification\n- Health status: `healthy` (< 80%), `warning` (80-99%), `stale` (≥ 100%)\n\nResults are ordered by health status (stale first) then time in state.\n\n# Use Cases\n\n- **Alerting**: Monitor tasks at 80%+ threshold (warning status)\n- **Prevention**: Investigate tasks before they hit DLQ\n- **Capacity Planning**: Identify systemic staleness patterns\n\n# Example\n\n```text\nGET /v1/dlq/staleness?limit=50\n```\n\n**Required Permission:** `dlq:read`",
        "operationId": "get_staleness_monitoring",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum tasks to return (default: 100)",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Task staleness monitoring data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/StalenessMonitoring"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "500": {
            "description": "Database error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "dlq:read"
      }
    },
    "/v1/dlq/stats": {
      "get": {
        "tags": [
          "dlq"
        ],
        "summary": "Get DLQ statistics: GET /v1/dlq/stats",
        "description": "Returns aggregated statistics for DLQ entries grouped by reason.\nUseful for identifying systemic issues and patterns.\n\n# Response\n\nReturns statistics including:\n- Total entries per reason\n- Count by resolution status (pending, resolved, failed)\n- Oldest and newest entry timestamps\n\n# Example\n\n```text\nGET /v1/dlq/stats\n```\n\n**Required Permission:** `dlq:stats`",
        "operationId": "get_dlq_stats",
        "responses": {
          "200": {
            "description": "DLQ statistics",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/DlqStats"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "500": {
            "description": "Database error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "dlq:stats"
      }
    },
    "/v1/dlq/task/{task_uuid}": {
      "get": {
        "tags": [
          "dlq"
        ],
        "summary": "Get DLQ entry with full task snapshot: GET /v1/dlq/task/{task_uuid}",
        "description": "Returns the most recent DLQ entry for a task, including the complete\ntask snapshot (task + all steps state) for investigation.\n\n# Path Parameters\n\n- `task_uuid` - UUID of the task\n\n# Example\n\n```text\nGET /v1/dlq/task/550e8400-e29b-41d4-a716-446655440000\n```\n\n**Required Permission:** `dlq:read`",
        "operationId": "get_dlq_entry",
        "parameters": [
          {
            "name": "task_uuid",
            "in": "path",
            "description": "Task UUID",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "DLQ entry with full snapshot",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DlqEntry"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "404": {
            "description": "DLQ entry not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "500": {
            "description": "Database error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "dlq:read"
      }
    },
    "/v1/tasks": {
      "get": {
        "tags": [
          "tasks"
        ],
        "summary": "List tasks with pagination and filtering: GET /v1/tasks",
        "description": "Returns a paginated list of tasks with execution context using batch SQL functions.\nUsed by workers and administrators for task monitoring and management.\n\n**Required Permission:** `tasks:list`",
        "operationId": "list_tasks",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "Page number (default: 1)",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 0
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "description": "Items per page (default: 25, max: 100)",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 0
            }
          },
          {
            "name": "namespace",
            "in": "query",
            "description": "Filter by namespace",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "status",
            "in": "query",
            "description": "Filter by status",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "initiator",
            "in": "query",
            "description": "Filter by initiator",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "source_system",
            "in": "query",
            "description": "Filter by source system",
            "required": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of tasks",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TaskListResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid query parameters",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "503": {
            "description": "Service unavailable",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "tasks:list"
      },
      "post": {
        "tags": [
          "tasks"
        ],
        "summary": "Create a new task: POST /v1/tasks",
        "description": "This is the critical endpoint for TAS-40 worker integration.\nWorkers call this endpoint to create tasks and receive UUIDs for tracking.\n\nReturns the same `TaskResponse` shape as GET /v1/tasks/{uuid}, following REST best\npractices where create operations return the same representation as read operations.\n\n**Required Permission:** `tasks:create`",
        "operationId": "create_task",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TaskRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Task created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TaskResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "503": {
            "description": "Service unavailable",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "tasks:create"
      }
    },
    "/v1/tasks/{uuid}": {
      "get": {
        "tags": [
          "tasks"
        ],
        "summary": "Get task details: GET /v1/tasks/{uuid}",
        "description": "Returns comprehensive task information including execution context and step readiness.\nUsed by workers for task correlation and status tracking.\n\n**Required Permission:** `tasks:read`",
        "operationId": "get_task",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "Task UUID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Task details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TaskResponse"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "404": {
            "description": "Task not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "503": {
            "description": "Service unavailable",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "tasks:read"
      },
      "delete": {
        "tags": [
          "tasks"
        ],
        "summary": "Cancel a task: DELETE /v1/tasks/{uuid}",
        "description": "Cancels a task if it's in a cancellable state and triggers orchestration events.\nReturns the updated task with execution context and step information.\n\n**Required Permission:** `tasks:cancel`",
        "operationId": "cancel_task",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "Task UUID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Task cancelled successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TaskResponse"
                }
              }
            }
          },
          "400": {
            "description": "Task cannot be cancelled",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "404": {
            "description": "Task not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "503": {
            "description": "Service unavailable",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "tasks:cancel"
      }
    },
    "/v1/tasks/{uuid}/workflow_steps": {
      "get": {
        "tags": [
          "workflow_steps"
        ],
        "summary": "List workflow steps for a task: GET /v1/tasks/{uuid}/workflow_steps",
        "description": "**Required Permission:** `steps:read`",
        "operationId": "list_task_steps",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "Task UUID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of workflow steps",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/StepResponse"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid task UUID",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "503": {
            "description": "Service unavailable",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "steps:read"
      }
    },
    "/v1/tasks/{uuid}/workflow_steps/{step_uuid}": {
      "get": {
        "tags": [
          "workflow_steps"
        ],
        "summary": "Get workflow step details: GET /v1/tasks/{uuid}/workflow_steps/{step_uuid}",
        "description": "**Required Permission:** `steps:read`",
        "operationId": "get_step",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "Task UUID",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "step_uuid",
            "in": "path",
            "description": "Step UUID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Workflow step details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StepResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid UUID",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "404": {
            "description": "Step not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "503": {
            "description": "Service unavailable",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "steps:read"
      },
      "patch": {
        "tags": [
          "workflow_steps"
        ],
        "summary": "Manually resolve or complete a workflow step: PATCH /v1/tasks/{uuid}/workflow_steps/{step_uuid}",
        "description": "This endpoint supports two resolution modes:\n\n1. **Simple Resolution** (`ResolveManually`): Marks the step as `resolved_manually` without providing execution results.\n   Use this when you want to acknowledge a step issue without continuing workflow execution.\n\n2. **Complete with Results** (`CompleteManually`): Provides execution results and transitions the step to `complete` state.\n   - Operators provide only `result` (business data) and optional `metadata`\n   - System automatically enforces `success: true` and `status: \"completed\"`\n   - Prevents operators from incorrectly setting `status` or `error` fields\n   - Dependent steps can consume the provided results, allowing workflow continuation\n\nYou can optionally reset the attempt counter when resolving a step that has exceeded retry limits.\n\n**Required Permission:** `steps:resolve`",
        "operationId": "resolve_step_manually",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "Task UUID",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "step_uuid",
            "in": "path",
            "description": "Step UUID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StepManualAction"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Step resolved successfully. The response indicates whether the step was marked as 'resolved_manually' (simple resolution) or 'complete' (with execution results).",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StepResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or step cannot be resolved",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "404": {
            "description": "Step not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "503": {
            "description": "Service unavailable",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "steps:resolve"
      }
    },
    "/v1/tasks/{uuid}/workflow_steps/{step_uuid}/audit": {
      "get": {
        "tags": [
          "workflow_steps"
        ],
        "summary": "Get audit history for a workflow step: GET /v1/tasks/{uuid}/workflow_steps/{step_uuid}/audit",
        "description": "Returns SOC2-compliant audit trail for step execution results (TAS-62).\nEach audit record includes:\n- Worker attribution (worker_uuid, correlation_id)\n- Execution summary (success, execution_time_ms)\n- Full execution result via JOIN to transition metadata\n\n## Response\n\nReturns an array of audit records ordered by recorded_at DESC (most recent first).\nEach record links to the transition that captured the execution result.\n\n**Required Permission:** `steps:read`",
        "operationId": "get_step_audit",
        "parameters": [
          {
            "name": "uuid",
            "in": "path",
            "description": "Task UUID",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "step_uuid",
            "in": "path",
            "description": "Step UUID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Audit history for the step",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/StepAuditResponse"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid UUID format",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "404": {
            "description": "Step not found or does not belong to task",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "503": {
            "description": "Service unavailable",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "steps:read"
      }
    },
    "/v1/templates": {
      "get": {
        "tags": [
          "templates"
        ],
        "summary": "List available templates",
        "description": "GET /v1/templates\n\nReturns a list of all registered task templates, optionally filtered by namespace.\nIncludes namespace summaries and template details.\n\n**Required Permission:** `templates:read`",
        "operationId": "list_templates",
        "parameters": [
          {
            "name": "namespace",
            "in": "query",
            "description": "Filter by namespace",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of available templates",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TemplateListResponse"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "503": {
            "description": "Service unavailable",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "templates:read"
      }
    },
    "/v1/templates/{namespace}/{name}/{version}": {
      "get": {
        "tags": [
          "templates"
        ],
        "summary": "Get a specific template by namespace, name, and version",
        "description": "GET /v1/templates/{namespace}/{name}/{version}\n\nReturns detailed information about a specific template including its step definitions.\n\n**Required Permission:** `templates:read`",
        "operationId": "get_template",
        "parameters": [
          {
            "name": "namespace",
            "in": "path",
            "description": "Template namespace",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "name",
            "in": "path",
            "description": "Template name",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "version",
            "in": "path",
            "description": "Template version",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Template details",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TemplateDetail"
                }
              }
            }
          },
          "401": {
            "description": "Authentication required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "403": {
            "description": "Insufficient permissions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "404": {
            "description": "Template not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          },
          "503": {
            "description": "Service unavailable",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearer_auth": []
          },
          {
            "api_key_auth": []
          }
        ],
        "x-required-permission": "templates:read"
      }
    }
  },
  "components": {
    "schemas": {
      "ApiError": {
        "oneOf": [
          {
            "type": "object",
            "required": [
              "NotFound"
            ],
            "properties": {
              "NotFound": {
                "type": "object",
                "required": [
                  "message"
                ],
                "properties": {
                  "message": {
                    "type": "string"
                  }
                }
              }
            }
          },
          {
            "type": "string",
            "enum": [
              "Forbidden"
            ]
          },
          {
            "type": "string",
            "enum": [
              "Unauthorized"
            ]
          },
          {
            "type": "object",
            "required": [
              "BadRequest"
            ],
            "properties": {
              "BadRequest": {
                "type": "object",
                "required": [
                  "message"
                ],
                "properties": {
                  "message": {
                    "type": "string"
                  }
                }
              }
            }
          },
          {
            "type": "object",
            "description": "TAS-154: Conflict - resource already exists (e.g., duplicate identity hash)",
            "required": [
              "Conflict"
            ],
            "properties": {
              "Conflict": {
                "type": "object",
                "description": "TAS-154: Conflict - resource already exists (e.g., duplicate identity hash)",
                "required": [
                  "message"
                ],
                "properties": {
                  "message": {
                    "type": "string"
                  }
                }
              }
            }
          },
          {
            "type": "string",
            "enum": [
              "ServiceUnavailable"
            ]
          },
          {
            "type": "string",
            "enum": [
              "Timeout"
            ]
          },
          {
            "type": "string",
            "enum": [
              "CircuitBreakerOpen"
            ]
          },
          {
            "type": "object",
            "description": "TAS-75: System backpressure active - includes Retry-After header",
            "required": [
              "Backpressure"
            ],
            "properties": {
              "Backpressure": {
                "type": "object",
                "description": "TAS-75: System backpressure active - includes Retry-After header",
                "required": [
                  "reason",
                  "retry_after_seconds"
                ],
                "properties": {
                  "reason": {
                    "type": "string"
                  },
                  "retry_after_seconds": {
                    "type": "integer",
                    "format": "int64",
                    "minimum": 0
                  }
                }
              }
            }
          },
          {
            "type": "object",
            "required": [
              "DatabaseError"
            ],
            "properties": {
              "DatabaseError": {
                "type": "object",
                "required": [
                  "operation"
                ],
                "properties": {
                  "operation": {
                    "type": "string"
                  }
                }
              }
            }
          },
          {
            "type": "object",
            "required": [
              "AuthenticationError"
            ],
            "properties": {
              "AuthenticationError": {
                "type": "object",
                "required": [
                  "reason"
                ],
                "properties": {
                  "failure_context": {
                    "oneOf": [
                      {
                        "type": "null"
                      },
                      {
                        "$ref": "#/components/schemas/AuthFailureContext",
                        "description": "Machine-readable failure context for gateway signaling headers"
                      }
                    ]
                  },
                  "reason": {
                    "type": "string"
                  }
                }
              }
            }
          },
          {
            "type": "object",
            "required": [
              "AuthorizationError"
            ],
            "properties": {
              "AuthorizationError": {
                "type": "object",
                "required": [
                  "reason"
                ],
                "properties": {
                  "failure_context": {
                    "oneOf": [
                      {
                        "type": "null"
                      },
                      {
                        "$ref": "#/components/schemas/AuthFailureContext",
                        "description": "Machine-readable failure context for gateway signaling headers"
                      }
                    ]
                  },
                  "reason": {
                    "type": "string"
                  }
                }
              }
            }
          },
          {
            "type": "object",
            "required": [
              "InvalidUuid"
            ],
            "properties": {
              "InvalidUuid": {
                "type": "object",
                "required": [
                  "uuid"
                ],
                "properties": {
                  "uuid": {
                    "type": "string"
                  }
                }
              }
            }
          },
          {
            "type": "string",
            "enum": [
              "JsonError"
            ]
          },
          {
            "type": "string",
            "enum": [
              "Internal"
            ]
          }
        ],
        "description": "Web API specific errors with HTTP status code mappings"
      },
      "AuthFailureContext": {
        "type": "object",
        "description": "Auth failure context for gateway signaling.\n\nIncluded in 401/403 response headers so upstream gateways (ALB, NLB, API Gateway)\ncan make informed rate-limiting decisions based on failure severity.",
        "required": [
          "reason",
          "severity"
        ],
        "properties": {
          "reason": {
            "$ref": "#/components/schemas/AuthFailureReason",
            "description": "Machine-readable failure category"
          },
          "severity": {
            "$ref": "#/components/schemas/AuthFailureSeverity",
            "description": "Suggested severity for gateway action"
          }
        }
      },
      "AuthFailureReason": {
        "type": "string",
        "description": "Machine-readable auth failure reasons.",
        "enum": [
          "Missing",
          "Expired",
          "Invalid",
          "Malformed",
          "Forbidden"
        ]
      },
      "AuthFailureSeverity": {
        "type": "string",
        "description": "Severity levels for auth failures (signals gateway rate-limiting behavior).",
        "enum": [
          "Low",
          "Medium",
          "High"
        ]
      },
      "BottleneckAnalysis": {
        "type": "object",
        "description": "Bottleneck analysis response",
        "required": [
          "slow_steps",
          "slow_tasks",
          "resource_utilization",
          "recommendations"
        ],
        "properties": {
          "recommendations": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "resource_utilization": {
            "$ref": "#/components/schemas/ResourceUtilization"
          },
          "slow_steps": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SlowStepInfo"
            }
          },
          "slow_tasks": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SlowTaskInfo"
            }
          }
        }
      },
      "ConfigMetadata": {
        "type": "object",
        "description": "Response metadata (non-sensitive system info).",
        "required": [
          "timestamp",
          "environment",
          "version"
        ],
        "properties": {
          "environment": {
            "type": "string"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "version": {
            "type": "string"
          }
        }
      },
      "DetailedHealthChecks": {
        "type": "object",
        "description": "Full health checks for detailed health endpoint",
        "required": [
          "web_database",
          "orchestration_database",
          "circuit_breaker",
          "orchestration_system",
          "command_processor",
          "pool_utilization",
          "queue_depth",
          "channel_saturation"
        ],
        "properties": {
          "channel_saturation": {
            "$ref": "#/components/schemas/HealthCheck"
          },
          "circuit_breaker": {
            "$ref": "#/components/schemas/HealthCheck"
          },
          "command_processor": {
            "$ref": "#/components/schemas/HealthCheck"
          },
          "orchestration_database": {
            "$ref": "#/components/schemas/HealthCheck"
          },
          "orchestration_system": {
            "$ref": "#/components/schemas/HealthCheck"
          },
          "pool_utilization": {
            "$ref": "#/components/schemas/HealthCheck"
          },
          "queue_depth": {
            "$ref": "#/components/schemas/HealthCheck"
          },
          "web_database": {
            "$ref": "#/components/schemas/HealthCheck"
          }
        }
      },
      "DetailedHealthResponse": {
        "type": "object",
        "description": "Detailed health check response",
        "required": [
          "status",
          "timestamp",
          "checks",
          "info"
        ],
        "properties": {
          "checks": {
            "$ref": "#/components/schemas/DetailedHealthChecks"
          },
          "info": {
            "$ref": "#/components/schemas/HealthInfo"
          },
          "status": {
            "type": "string"
          },
          "timestamp": {
            "type": "string"
          }
        }
      },
      "DlqEntry": {
        "type": "object",
        "description": "DLQ Entry\n\nComplete DLQ investigation record. Maps to `tasker.tasks_dlq` table.\n\nArchitecture:\n- DLQ is an INVESTIGATION TRACKER (not task manipulation layer)\n- Tasks remain in tasker.tasks table (typically in Error state)\n- DLQ entries track \"why stuck\" and \"what operator did\"\n- Multiple DLQ entries per task allowed (historical trail)\n- Only one \"pending\" investigation per task at a time",
        "required": [
          "dlq_entry_uuid",
          "task_uuid",
          "original_state",
          "dlq_reason",
          "dlq_timestamp",
          "resolution_status",
          "task_snapshot",
          "created_at",
          "updated_at"
        ],
        "properties": {
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "Entry creation timestamp"
          },
          "dlq_entry_uuid": {
            "type": "string",
            "format": "uuid",
            "description": "Unique identifier for this DLQ entry"
          },
          "dlq_reason": {
            "$ref": "#/components/schemas/DlqReason",
            "description": "Why task was sent to DLQ"
          },
          "dlq_timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "When task was added to DLQ"
          },
          "metadata": {
            "description": "Additional metadata (JSONB)\nExamples: error stack trace, detection method, related tasks"
          },
          "original_state": {
            "type": "string",
            "description": "Task state when sent to DLQ"
          },
          "resolution_notes": {
            "type": [
              "string",
              "null"
            ],
            "description": "Investigation notes and resolution details"
          },
          "resolution_status": {
            "$ref": "#/components/schemas/DlqResolutionStatus",
            "description": "Current investigation status"
          },
          "resolution_timestamp": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time",
            "description": "When investigation was resolved (if resolved)"
          },
          "resolved_by": {
            "type": [
              "string",
              "null"
            ],
            "description": "Who resolved the investigation (user or system)"
          },
          "task_snapshot": {
            "description": "Complete task snapshot at DLQ time (JSONB)\nContains: task details, steps, transitions, execution context"
          },
          "task_uuid": {
            "type": "string",
            "format": "uuid",
            "description": "Task under investigation"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "Entry last update timestamp"
          }
        }
      },
      "DlqInvestigationQueueEntry": {
        "type": "object",
        "description": "DLQ investigation queue entry with priority scoring\n\nSourced from `v_dlq_investigation_queue` view for operator triage dashboard.\nEntries are sorted by priority score (higher = more urgent).",
        "required": [
          "dlq_entry_uuid",
          "task_uuid",
          "original_state",
          "dlq_reason",
          "dlq_timestamp",
          "minutes_in_dlq",
          "priority_score"
        ],
        "properties": {
          "current_state": {
            "type": [
              "string",
              "null"
            ]
          },
          "dlq_entry_uuid": {
            "type": "string",
            "format": "uuid"
          },
          "dlq_reason": {
            "$ref": "#/components/schemas/DlqReason"
          },
          "dlq_timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "minutes_in_dlq": {
            "type": "number",
            "format": "double"
          },
          "namespace_name": {
            "type": [
              "string",
              "null"
            ]
          },
          "original_state": {
            "type": "string"
          },
          "priority_score": {
            "type": "number",
            "format": "double"
          },
          "task_name": {
            "type": [
              "string",
              "null"
            ]
          },
          "task_uuid": {
            "type": "string",
            "format": "uuid"
          },
          "time_in_state_minutes": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int32"
          }
        }
      },
      "DlqReason": {
        "type": "string",
        "description": "DLQ Reason\n\nWhy was a task sent to DLQ? Determines investigation priority and remediation approach.\nThis enum maps to the PostgreSQL `dlq_reason` enum type.",
        "enum": [
          "StalenessTimeout",
          "MaxRetriesExceeded",
          "DependencyCycleDetected",
          "WorkerUnavailable",
          "ManualDlq"
        ]
      },
      "DlqResolutionStatus": {
        "type": "string",
        "description": "DLQ Resolution Status\n\nTracks the lifecycle of a DLQ investigation (NOT task state).\nThis enum maps to the PostgreSQL `dlq_resolution_status` enum type.\n\nState Machine:\n- `pending` → `manually_resolved` (operator fixed problem via step APIs)\n- `pending` → `permanently_failed` (unfixable issue, task stays in Error state)\n- `pending` → `cancelled` (investigation no longer needed)\n\nA task can have multiple DLQ entries over time (investigation history),\nbut only one pending entry at a time (enforced by unique index).",
        "enum": [
          "Pending",
          "ManuallyResolved",
          "PermanentlyFailed",
          "Cancelled"
        ]
      },
      "DlqStats": {
        "type": "object",
        "description": "DLQ statistics by reason\n\nSourced from `v_dlq_dashboard` view for high-level DLQ monitoring.",
        "required": [
          "dlq_reason",
          "total_entries",
          "pending",
          "manually_resolved",
          "permanent_failures",
          "cancelled"
        ],
        "properties": {
          "avg_resolution_time_minutes": {
            "type": [
              "number",
              "null"
            ],
            "format": "double"
          },
          "cancelled": {
            "type": "integer",
            "format": "int64"
          },
          "dlq_reason": {
            "$ref": "#/components/schemas/DlqReason"
          },
          "manually_resolved": {
            "type": "integer",
            "format": "int64"
          },
          "newest_entry": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          },
          "oldest_entry": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          },
          "pending": {
            "type": "integer",
            "format": "int64"
          },
          "permanent_failures": {
            "type": "integer",
            "format": "int64"
          },
          "total_entries": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "ExecutionStatus": {
        "type": "string",
        "description": "Execution status returned by the SQL get_task_execution_context function\nMatches the execution_status values from the SQL function",
        "enum": [
          "has_ready_steps",
          "processing",
          "blocked_by_failures",
          "all_complete",
          "waiting_for_dependencies"
        ]
      },
      "HealthCheck": {
        "type": "object",
        "description": "Individual health check result",
        "required": [
          "status",
          "duration_ms"
        ],
        "properties": {
          "duration_ms": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "message": {
            "type": [
              "string",
              "null"
            ]
          },
          "status": {
            "type": "string"
          }
        }
      },
      "HealthInfo": {
        "type": "object",
        "description": "System information for detailed health",
        "required": [
          "version",
          "environment",
          "operational_state",
          "web_database_pool_size",
          "orchestration_database_pool_size",
          "circuit_breaker_state"
        ],
        "properties": {
          "circuit_breaker_state": {
            "type": "string"
          },
          "environment": {
            "type": "string"
          },
          "operational_state": {
            "type": "string"
          },
          "orchestration_database_pool_size": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          },
          "pool_utilization": {
            "oneOf": [
              {
                "type": "null"
              },
              {
                "$ref": "#/components/schemas/PoolUtilizationInfo",
                "description": "Connection pool utilization details (TAS-164)"
              }
            ]
          },
          "version": {
            "type": "string"
          },
          "web_database_pool_size": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          }
        }
      },
      "HealthResponse": {
        "type": "object",
        "description": "Basic health check response",
        "required": [
          "status",
          "timestamp"
        ],
        "properties": {
          "status": {
            "type": "string"
          },
          "timestamp": {
            "type": "string"
          }
        }
      },
      "ManualCompletionData": {
        "type": "object",
        "description": "Manual completion data for providing step execution results\n\nThis structure contains only the operator-provided business data.\nThe system will automatically set:\n- `success: true` (manual completion implies success)\n- `status: \"completed\"` (always completed for manual resolution)\n- `error: None` (no errors for successful manual completion)",
        "required": [
          "result"
        ],
        "properties": {
          "metadata": {
            "description": "Optional metadata for observability and tracking\n\nCan include execution timing, resource usage, or other operational metadata."
          },
          "result": {
            "description": "The actual result data for this step\n\nThis should contain the business data that dependent steps expect.\nThe shape must match what downstream step handlers require."
          }
        }
      },
      "NamespaceSummary": {
        "type": "object",
        "description": "Summary of a namespace with its templates",
        "required": [
          "name",
          "template_count"
        ],
        "properties": {
          "description": {
            "type": [
              "string",
              "null"
            ],
            "description": "Optional namespace description"
          },
          "name": {
            "type": "string",
            "description": "Namespace name"
          },
          "template_count": {
            "type": "integer",
            "description": "Number of templates in this namespace",
            "minimum": 0
          }
        }
      },
      "OrchestrationConfigResponse": {
        "type": "object",
        "description": "Orchestration configuration response (whitelist-only).\n\nOnly exposes operational metadata that is safe for external consumption.\nNo secrets, credentials, keys, or database URLs are included.\nAdding new fields requires a conscious decision about sensitivity.",
        "required": [
          "metadata",
          "auth",
          "circuit_breakers",
          "database_pools",
          "deployment_mode",
          "messaging"
        ],
        "properties": {
          "auth": {
            "$ref": "#/components/schemas/SafeAuthConfig"
          },
          "circuit_breakers": {
            "$ref": "#/components/schemas/SafeCircuitBreakerConfig"
          },
          "database_pools": {
            "$ref": "#/components/schemas/SafeDatabasePoolConfig"
          },
          "deployment_mode": {
            "type": "string"
          },
          "messaging": {
            "$ref": "#/components/schemas/SafeMessagingConfig"
          },
          "metadata": {
            "$ref": "#/components/schemas/ConfigMetadata"
          }
        }
      },
      "PaginationInfo": {
        "type": "object",
        "description": "Pagination metadata",
        "required": [
          "page",
          "per_page",
          "total_count",
          "total_pages",
          "has_next",
          "has_previous"
        ],
        "properties": {
          "has_next": {
            "type": "boolean"
          },
          "has_previous": {
            "type": "boolean"
          },
          "page": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          },
          "per_page": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          },
          "total_count": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "total_pages": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          }
        }
      },
      "PerformanceMetrics": {
        "type": "object",
        "description": "Performance metrics response",
        "required": [
          "total_tasks",
          "active_tasks",
          "completed_tasks",
          "failed_tasks",
          "completion_rate",
          "error_rate",
          "average_task_duration_seconds",
          "average_step_duration_seconds",
          "tasks_per_hour",
          "steps_per_hour",
          "system_health_score",
          "analysis_period_start",
          "calculated_at"
        ],
        "properties": {
          "active_tasks": {
            "type": "integer",
            "format": "int64"
          },
          "analysis_period_start": {
            "type": "string"
          },
          "average_step_duration_seconds": {
            "type": "number",
            "format": "double"
          },
          "average_task_duration_seconds": {
            "type": "number",
            "format": "double"
          },
          "calculated_at": {
            "type": "string"
          },
          "completed_tasks": {
            "type": "integer",
            "format": "int64"
          },
          "completion_rate": {
            "type": "number",
            "format": "double"
          },
          "error_rate": {
            "type": "number",
            "format": "double"
          },
          "failed_tasks": {
            "type": "integer",
            "format": "int64"
          },
          "steps_per_hour": {
            "type": "integer",
            "format": "int64"
          },
          "system_health_score": {
            "type": "number",
            "format": "double"
          },
          "tasks_per_hour": {
            "type": "integer",
            "format": "int64"
          },
          "total_tasks": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "PoolDetail": {
        "type": "object",
        "description": "Detailed metrics for a single connection pool (TAS-164)",
        "required": [
          "active_connections",
          "idle_connections",
          "max_connections",
          "utilization_percent",
          "total_acquires",
          "slow_acquires",
          "acquire_errors",
          "average_acquire_time_ms",
          "max_acquire_time_ms"
        ],
        "properties": {
          "acquire_errors": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "active_connections": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          },
          "average_acquire_time_ms": {
            "type": "number",
            "format": "double"
          },
          "idle_connections": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          },
          "max_acquire_time_ms": {
            "type": "number",
            "format": "double"
          },
          "max_connections": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          },
          "slow_acquires": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "total_acquires": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "utilization_percent": {
            "type": "number",
            "format": "double"
          }
        }
      },
      "PoolUtilizationInfo": {
        "type": "object",
        "description": "Connection pool utilization information (TAS-164)\n\nShared between orchestration and worker health responses.\nEach service instance reports its own pool utilization.",
        "required": [
          "tasker_pool",
          "pgmq_pool"
        ],
        "properties": {
          "pgmq_pool": {
            "$ref": "#/components/schemas/PoolDetail"
          },
          "tasker_pool": {
            "$ref": "#/components/schemas/PoolDetail"
          }
        }
      },
      "ReadinessChecks": {
        "type": "object",
        "description": "Core health checks for readiness probe",
        "required": [
          "web_database",
          "orchestration_database",
          "circuit_breaker",
          "orchestration_system",
          "command_processor"
        ],
        "properties": {
          "circuit_breaker": {
            "$ref": "#/components/schemas/HealthCheck"
          },
          "command_processor": {
            "$ref": "#/components/schemas/HealthCheck"
          },
          "orchestration_database": {
            "$ref": "#/components/schemas/HealthCheck"
          },
          "orchestration_system": {
            "$ref": "#/components/schemas/HealthCheck"
          },
          "web_database": {
            "$ref": "#/components/schemas/HealthCheck"
          }
        }
      },
      "ReadinessResponse": {
        "type": "object",
        "description": "Readiness health check response (subset of detailed checks)",
        "required": [
          "status",
          "timestamp",
          "checks",
          "info"
        ],
        "properties": {
          "checks": {
            "$ref": "#/components/schemas/ReadinessChecks"
          },
          "info": {
            "$ref": "#/components/schemas/HealthInfo"
          },
          "status": {
            "type": "string"
          },
          "timestamp": {
            "type": "string"
          }
        }
      },
      "RecommendedAction": {
        "type": "string",
        "description": "Recommended action returned by the SQL get_task_execution_context function\nMatches the recommended_action values from the SQL function",
        "enum": [
          "execute_ready_steps",
          "wait_for_completion",
          "handle_failures",
          "finalize_task",
          "wait_for_dependencies"
        ]
      },
      "ResourceUtilization": {
        "type": "object",
        "description": "Resource utilization metrics",
        "required": [
          "database_pool_utilization",
          "system_health"
        ],
        "properties": {
          "database_pool_utilization": {
            "type": "number",
            "format": "double"
          },
          "system_health": {
            "$ref": "#/components/schemas/SystemHealthCounts"
          }
        }
      },
      "SafeAuthConfig": {
        "type": "object",
        "description": "Non-sensitive auth configuration summary.\n\nExposes whether auth is enabled and how it's configured,\nwithout revealing keys, secrets, or credential values.",
        "required": [
          "enabled",
          "verification_method",
          "jwt_issuer",
          "jwt_audience",
          "api_key_header",
          "api_key_count",
          "strict_validation",
          "allowed_algorithms"
        ],
        "properties": {
          "allowed_algorithms": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "api_key_count": {
            "type": "integer",
            "description": "Number of configured API keys (not their values)",
            "minimum": 0
          },
          "api_key_header": {
            "type": "string"
          },
          "enabled": {
            "type": "boolean"
          },
          "jwt_audience": {
            "type": "string"
          },
          "jwt_issuer": {
            "type": "string"
          },
          "strict_validation": {
            "type": "boolean"
          },
          "verification_method": {
            "type": "string",
            "description": "Verification method: \"public_key\", \"jwks\", or \"none\""
          }
        }
      },
      "SafeCircuitBreakerConfig": {
        "type": "object",
        "description": "Non-sensitive circuit breaker configuration.",
        "required": [
          "enabled",
          "failure_threshold",
          "timeout_seconds",
          "success_threshold"
        ],
        "properties": {
          "enabled": {
            "type": "boolean"
          },
          "failure_threshold": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          },
          "success_threshold": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          },
          "timeout_seconds": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          }
        }
      },
      "SafeDatabasePoolConfig": {
        "type": "object",
        "description": "Non-sensitive database pool configuration.",
        "required": [
          "web_api_pool_size",
          "web_api_max_connections"
        ],
        "properties": {
          "web_api_max_connections": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          },
          "web_api_pool_size": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          }
        }
      },
      "SafeMessagingConfig": {
        "type": "object",
        "description": "Non-sensitive messaging configuration.\n\nExposes backend type and queue names — these are operational\nmetadata useful for debugging, not secrets.",
        "required": [
          "backend",
          "queues"
        ],
        "properties": {
          "backend": {
            "type": "string",
            "description": "Backend type: \"pgmq\" or \"rabbitmq\""
          },
          "queues": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Queue names owned by this component"
          }
        }
      },
      "SlowStepInfo": {
        "type": "object",
        "description": "Information about slow-performing steps\n\nSteps are identified by (namespace, task_name, version, step_name) since\nstep names are only unique within a task template context.",
        "required": [
          "namespace_name",
          "task_name",
          "version",
          "step_name",
          "average_duration_seconds",
          "max_duration_seconds",
          "execution_count",
          "error_count",
          "error_rate"
        ],
        "properties": {
          "average_duration_seconds": {
            "type": "number",
            "format": "double"
          },
          "error_count": {
            "type": "integer",
            "format": "int64"
          },
          "error_rate": {
            "type": "number",
            "format": "double"
          },
          "execution_count": {
            "type": "integer",
            "format": "int64"
          },
          "last_executed_at": {
            "type": [
              "string",
              "null"
            ]
          },
          "max_duration_seconds": {
            "type": "number",
            "format": "double"
          },
          "namespace_name": {
            "type": "string",
            "description": "Namespace containing the task template"
          },
          "step_name": {
            "type": "string",
            "description": "Step name (unique within template)"
          },
          "task_name": {
            "type": "string",
            "description": "Task template name"
          },
          "version": {
            "type": "string",
            "description": "Task template version"
          }
        }
      },
      "SlowTaskInfo": {
        "type": "object",
        "description": "Information about slow-performing tasks\n\nTasks are identified by (namespace, task_name, version) - the template identity.",
        "required": [
          "namespace_name",
          "task_name",
          "version",
          "average_duration_seconds",
          "max_duration_seconds",
          "execution_count",
          "average_step_count",
          "error_count",
          "error_rate"
        ],
        "properties": {
          "average_duration_seconds": {
            "type": "number",
            "format": "double"
          },
          "average_step_count": {
            "type": "number",
            "format": "double"
          },
          "error_count": {
            "type": "integer",
            "format": "int64"
          },
          "error_rate": {
            "type": "number",
            "format": "double"
          },
          "execution_count": {
            "type": "integer",
            "format": "int64"
          },
          "last_executed_at": {
            "type": [
              "string",
              "null"
            ]
          },
          "max_duration_seconds": {
            "type": "number",
            "format": "double"
          },
          "namespace_name": {
            "type": "string",
            "description": "Namespace containing the task template"
          },
          "task_name": {
            "type": "string",
            "description": "Task template name"
          },
          "version": {
            "type": "string",
            "description": "Task template version"
          }
        }
      },
      "StalenessHealthStatus": {
        "type": "string",
        "description": "Health status classification for task staleness monitoring\n\nIndicates how close a task is to exceeding its staleness threshold.",
        "enum": [
          "healthy",
          "warning",
          "stale"
        ]
      },
      "StalenessMonitoring": {
        "type": "object",
        "description": "Staleness monitoring data for active tasks\n\nSourced from `v_task_staleness_monitoring` view for real-time health monitoring.\nProvides per-task visibility into staleness with health status classification.",
        "required": [
          "task_uuid",
          "current_state",
          "time_in_state_minutes",
          "task_age_minutes",
          "staleness_threshold_minutes",
          "health_status",
          "priority"
        ],
        "properties": {
          "current_state": {
            "type": "string",
            "description": "Current task state"
          },
          "health_status": {
            "$ref": "#/components/schemas/StalenessHealthStatus",
            "description": "Health status classification"
          },
          "namespace_name": {
            "type": [
              "string",
              "null"
            ],
            "description": "Namespace name (for context)"
          },
          "priority": {
            "type": "integer",
            "format": "int32",
            "description": "Task priority (from configuration)"
          },
          "staleness_threshold_minutes": {
            "type": "integer",
            "format": "int32",
            "description": "Staleness threshold for this state (considers template overrides)"
          },
          "task_age_minutes": {
            "type": "integer",
            "format": "int32",
            "description": "Total task age in minutes"
          },
          "task_name": {
            "type": [
              "string",
              "null"
            ],
            "description": "Task template name (for context)"
          },
          "task_uuid": {
            "type": "string",
            "format": "uuid",
            "description": "Task UUID being monitored"
          },
          "time_in_state_minutes": {
            "type": "integer",
            "format": "int32",
            "description": "Minutes task has been in current state"
          }
        }
      },
      "StepAuditResponse": {
        "type": "object",
        "description": "Step audit record response for SOC2-compliant audit trails (TAS-62)\n\nProvides attribution context (worker_uuid, correlation_id) and execution summary\nwith full results retrieved via JOIN to the transitions table.\n\n## Usage\n\n```json\nGET /v1/tasks/{uuid}/workflow_steps/{step_uuid}/audit\n[\n  {\n    \"audit_uuid\": \"01934567-89ab-cdef-0123-456789abcdef\",\n    \"workflow_step_uuid\": \"...\",\n    \"transition_uuid\": \"...\",\n    \"task_uuid\": \"...\",\n    \"recorded_at\": \"2025-12-03T10:30:00Z\",\n    \"worker_uuid\": \"worker-abc-123\",\n    \"correlation_id\": \"corr-xyz-789\",\n    \"success\": true,\n    \"execution_time_ms\": 150,\n    \"result\": { ... },\n    \"step_name\": \"validate_order\",\n    \"from_state\": \"in_progress\",\n    \"to_state\": \"enqueued_for_orchestration\"\n  }\n]\n```",
        "required": [
          "audit_uuid",
          "workflow_step_uuid",
          "transition_uuid",
          "task_uuid",
          "recorded_at",
          "success",
          "step_name",
          "to_state"
        ],
        "properties": {
          "audit_uuid": {
            "type": "string",
            "description": "Primary key of the audit record"
          },
          "correlation_id": {
            "type": [
              "string",
              "null"
            ],
            "description": "Correlation ID for distributed tracing"
          },
          "execution_time_ms": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int64",
            "description": "Execution time in milliseconds"
          },
          "from_state": {
            "type": [
              "string",
              "null"
            ],
            "description": "State before the transition"
          },
          "recorded_at": {
            "type": "string",
            "description": "When the audit record was created (ISO 8601 format)"
          },
          "result": {
            "description": "Full execution result from the transition"
          },
          "step_name": {
            "type": "string",
            "description": "Name of the step"
          },
          "success": {
            "type": "boolean",
            "description": "Whether the step execution succeeded"
          },
          "task_uuid": {
            "type": "string",
            "description": "The parent task"
          },
          "to_state": {
            "type": "string",
            "description": "State after the transition"
          },
          "transition_uuid": {
            "type": "string",
            "description": "The specific transition that recorded the result"
          },
          "worker_uuid": {
            "type": [
              "string",
              "null"
            ],
            "description": "UUID of the worker instance that processed this step"
          },
          "workflow_step_uuid": {
            "type": "string",
            "description": "The workflow step this audit record belongs to"
          }
        }
      },
      "StepDefinition": {
        "type": "object",
        "description": "Definition of a step within a template",
        "required": [
          "name",
          "default_retryable",
          "default_max_attempts"
        ],
        "properties": {
          "default_max_attempts": {
            "type": "integer",
            "format": "int32",
            "description": "Maximum retry attempts"
          },
          "default_retryable": {
            "type": "boolean",
            "description": "Whether the step is retryable by default"
          },
          "description": {
            "type": [
              "string",
              "null"
            ],
            "description": "Step description"
          },
          "name": {
            "type": "string",
            "description": "Step name/handler identifier"
          }
        }
      },
      "StepManualAction": {
        "oneOf": [
          {
            "type": "object",
            "description": "Reset attempt counter and return step to pending for automatic retry\n\nState transition: `error` → `pending`\nAttempt counter: Reset to 0\nUse case: Transient failures that should be retried naturally",
            "required": [
              "reason",
              "reset_by",
              "action_type"
            ],
            "properties": {
              "action_type": {
                "type": "string",
                "enum": [
                  "reset_for_retry"
                ]
              },
              "reason": {
                "type": "string",
                "description": "Human-readable reason for reset"
              },
              "reset_by": {
                "type": "string",
                "description": "Operator performing the reset"
              }
            }
          },
          {
            "type": "object",
            "description": "Mark step as manually resolved without providing results\n\nState transition: Any state → `resolved_manually`\nTerminal state: Yes\nUse case: Acknowledge failure, move workflow forward without correction",
            "required": [
              "reason",
              "resolved_by",
              "action_type"
            ],
            "properties": {
              "action_type": {
                "type": "string",
                "enum": [
                  "resolve_manually"
                ]
              },
              "reason": {
                "type": "string",
                "description": "Human-readable reason for manual resolution"
              },
              "resolved_by": {
                "type": "string",
                "description": "Operator performing the resolution"
              }
            }
          },
          {
            "type": "object",
            "description": "Complete step manually with execution results\n\nState transition: Any state → `complete`\nTerminal state: Yes\nUse case: Provide corrected data for dependent steps to consume\n\nSystem enforces `success: true` and `status: \"completed\"`.\nOperator only provides `result` and optional `metadata`.",
            "required": [
              "completion_data",
              "reason",
              "completed_by",
              "action_type"
            ],
            "properties": {
              "action_type": {
                "type": "string",
                "enum": [
                  "complete_manually"
                ]
              },
              "completed_by": {
                "type": "string",
                "description": "Operator performing the completion"
              },
              "completion_data": {
                "$ref": "#/components/schemas/ManualCompletionData",
                "description": "Execution results to persist\n\nContains business data that dependent steps expect.\nSystem automatically wraps this in `StepExecutionResult` with:\n- `success: true`\n- `status: \"completed\"`\n- `error: null`"
              },
              "reason": {
                "type": "string",
                "description": "Human-readable reason for manual completion"
              }
            }
          }
        ],
        "description": "Manual step action request for PATCH /tasks/{uuid}/workflow_steps/{step_uuid}\n\nSupports three distinct operator actions via tagged enum:\n\n## 1. Reset for Retry\nReset attempt counter and return step to `pending` for automatic retry.\nUse when the issue was transient and natural retry should succeed.\n\n```json\n{\n  \"action_type\": \"reset_for_retry\",\n  \"reason\": \"Database connection restored, retry should succeed\",\n  \"reset_by\": \"operator@example.com\"\n}\n```\n\n## 2. Resolve Manually (Simple)\nMark step as `resolved_manually` without providing results.\nUse when acknowledging failure and moving workflow forward without correction.\n\n```json\n{\n  \"action_type\": \"resolve_manually\",\n  \"reason\": \"Non-critical validation step, bypassing\",\n  \"resolved_by\": \"operator@example.com\"\n}\n```\n\n## 3. Complete Manually (with Results)\nTransition step to `complete` with operator-provided execution results.\nUse when providing corrected data for dependent steps to consume.\n\n```json\n{\n  \"action_type\": \"complete_manually\",\n  \"completion_data\": {\n    \"result\": {\"validated\": true, \"score\": 95},\n    \"metadata\": {\"manually_verified\": true}\n  },\n  \"reason\": \"Manual verification completed\",\n  \"completed_by\": \"operator@example.com\"\n}\n```"
      },
      "StepReadinessStatus": {
        "type": "object",
        "description": "Comprehensive step readiness analysis\nEquivalent to Rails: FunctionBasedStepReadinessStatus",
        "required": [
          "workflow_step_uuid",
          "task_uuid",
          "named_step_uuid",
          "name",
          "current_state",
          "dependencies_satisfied",
          "retry_eligible",
          "ready_for_execution",
          "total_parents",
          "completed_parents",
          "attempts",
          "max_attempts"
        ],
        "properties": {
          "attempts": {
            "type": "integer",
            "format": "int32"
          },
          "backoff_request_seconds": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int32"
          },
          "completed_parents": {
            "type": "integer",
            "format": "int32"
          },
          "current_state": {
            "type": "string"
          },
          "dependencies_satisfied": {
            "type": "boolean"
          },
          "last_attempted_at": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          },
          "last_failure_at": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          },
          "max_attempts": {
            "type": "integer",
            "format": "int32"
          },
          "name": {
            "type": "string"
          },
          "named_step_uuid": {
            "type": "string",
            "format": "uuid"
          },
          "next_retry_at": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          },
          "ready_for_execution": {
            "type": "boolean"
          },
          "retry_eligible": {
            "type": "boolean"
          },
          "task_uuid": {
            "type": "string",
            "format": "uuid"
          },
          "total_parents": {
            "type": "integer",
            "format": "int32"
          },
          "workflow_step_uuid": {
            "type": "string",
            "format": "uuid"
          }
        }
      },
      "StepResponse": {
        "type": "object",
        "description": "Step details response with readiness information",
        "required": [
          "step_uuid",
          "task_uuid",
          "name",
          "created_at",
          "updated_at",
          "current_state",
          "dependencies_satisfied",
          "retry_eligible",
          "ready_for_execution",
          "total_parents",
          "completed_parents",
          "attempts",
          "max_attempts"
        ],
        "properties": {
          "attempts": {
            "type": "integer",
            "format": "int32"
          },
          "completed_at": {
            "type": [
              "string",
              "null"
            ]
          },
          "completed_parents": {
            "type": "integer",
            "format": "int32"
          },
          "created_at": {
            "type": "string"
          },
          "current_state": {
            "type": "string"
          },
          "dependencies_satisfied": {
            "type": "boolean"
          },
          "last_attempted_at": {
            "type": [
              "string",
              "null"
            ]
          },
          "last_failure_at": {
            "type": [
              "string",
              "null"
            ]
          },
          "max_attempts": {
            "type": "integer",
            "format": "int32"
          },
          "name": {
            "type": "string"
          },
          "next_retry_at": {
            "type": [
              "string",
              "null"
            ]
          },
          "ready_for_execution": {
            "type": "boolean"
          },
          "results": {},
          "retry_eligible": {
            "type": "boolean"
          },
          "step_uuid": {
            "type": "string"
          },
          "task_uuid": {
            "type": "string"
          },
          "total_parents": {
            "type": "integer",
            "format": "int32"
          },
          "updated_at": {
            "type": "string"
          }
        }
      },
      "SystemHealthCounts": {
        "type": "object",
        "description": "System-wide health and performance counts\nEquivalent to Rails: FunctionBasedSystemHealthCounts\n\n**IMPORTANT**: Field names match the SQL function `get_system_health_counts()` output exactly.\nThe SQL function returns detailed task state columns, not an aggregated `in_progress_tasks`.",
        "required": [
          "pending_tasks",
          "initializing_tasks",
          "enqueuing_steps_tasks",
          "steps_in_process_tasks",
          "evaluating_results_tasks",
          "waiting_for_dependencies_tasks",
          "waiting_for_retry_tasks",
          "blocked_by_failures_tasks",
          "complete_tasks",
          "error_tasks",
          "cancelled_tasks",
          "resolved_manually_tasks",
          "total_tasks",
          "pending_steps",
          "enqueued_steps",
          "in_progress_steps",
          "enqueued_for_orchestration_steps",
          "enqueued_as_error_for_orchestration_steps",
          "waiting_for_retry_steps",
          "complete_steps",
          "error_steps",
          "cancelled_steps",
          "resolved_manually_steps",
          "total_steps"
        ],
        "properties": {
          "blocked_by_failures_tasks": {
            "type": "integer",
            "format": "int64"
          },
          "cancelled_steps": {
            "type": "integer",
            "format": "int64"
          },
          "cancelled_tasks": {
            "type": "integer",
            "format": "int64"
          },
          "complete_steps": {
            "type": "integer",
            "format": "int64"
          },
          "complete_tasks": {
            "type": "integer",
            "format": "int64"
          },
          "enqueued_as_error_for_orchestration_steps": {
            "type": "integer",
            "format": "int64"
          },
          "enqueued_for_orchestration_steps": {
            "type": "integer",
            "format": "int64"
          },
          "enqueued_steps": {
            "type": "integer",
            "format": "int64"
          },
          "enqueuing_steps_tasks": {
            "type": "integer",
            "format": "int64"
          },
          "error_steps": {
            "type": "integer",
            "format": "int64"
          },
          "error_tasks": {
            "type": "integer",
            "format": "int64"
          },
          "evaluating_results_tasks": {
            "type": "integer",
            "format": "int64"
          },
          "in_progress_steps": {
            "type": "integer",
            "format": "int64"
          },
          "initializing_tasks": {
            "type": "integer",
            "format": "int64"
          },
          "pending_steps": {
            "type": "integer",
            "format": "int64"
          },
          "pending_tasks": {
            "type": "integer",
            "format": "int64"
          },
          "resolved_manually_steps": {
            "type": "integer",
            "format": "int64"
          },
          "resolved_manually_tasks": {
            "type": "integer",
            "format": "int64"
          },
          "steps_in_process_tasks": {
            "type": "integer",
            "format": "int64"
          },
          "total_steps": {
            "type": "integer",
            "format": "int64"
          },
          "total_tasks": {
            "type": "integer",
            "format": "int64"
          },
          "waiting_for_dependencies_tasks": {
            "type": "integer",
            "format": "int64"
          },
          "waiting_for_retry_steps": {
            "type": "integer",
            "format": "int64"
          },
          "waiting_for_retry_tasks": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "TaskExecutionContext": {
        "type": "object",
        "description": "Represents computed task execution context and statistics.\n\n**UNIFIED VERSION**: Uses proper ExecutionStatus and RecommendedAction enums\ninstead of raw strings for type safety.\n\n**IMPORTANT**: This is NOT a database table - it's the result of calling\n`get_task_execution_context()` or `get_task_execution_contexts_batch()` SQL functions.",
        "required": [
          "task_uuid",
          "named_task_uuid",
          "status",
          "total_steps",
          "pending_steps",
          "in_progress_steps",
          "completed_steps",
          "failed_steps",
          "ready_steps",
          "execution_status",
          "completion_percentage",
          "health_status",
          "enqueued_steps"
        ],
        "properties": {
          "completed_steps": {
            "type": "integer",
            "format": "int64"
          },
          "completion_percentage": {
            "type": "string"
          },
          "enqueued_steps": {
            "type": "integer",
            "format": "int64"
          },
          "execution_status": {
            "$ref": "#/components/schemas/ExecutionStatus",
            "description": "Proper typed execution status (was raw string)"
          },
          "failed_steps": {
            "type": "integer",
            "format": "int64"
          },
          "health_status": {
            "type": "string"
          },
          "in_progress_steps": {
            "type": "integer",
            "format": "int64"
          },
          "named_task_uuid": {
            "type": "string",
            "format": "uuid"
          },
          "pending_steps": {
            "type": "integer",
            "format": "int64"
          },
          "ready_steps": {
            "type": "integer",
            "format": "int64"
          },
          "recommended_action": {
            "oneOf": [
              {
                "type": "null"
              },
              {
                "$ref": "#/components/schemas/RecommendedAction",
                "description": "Proper typed recommended action (was raw string)"
              }
            ]
          },
          "status": {
            "type": "string"
          },
          "task_uuid": {
            "type": "string",
            "format": "uuid"
          },
          "total_steps": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "TaskListResponse": {
        "type": "object",
        "description": "Task list response with pagination",
        "required": [
          "tasks",
          "pagination"
        ],
        "properties": {
          "pagination": {
            "$ref": "#/components/schemas/PaginationInfo"
          },
          "tasks": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/TaskResponse"
            }
          }
        }
      },
      "TaskRequest": {
        "type": "object",
        "description": "TaskRequest represents an incoming request to create and execute a task\nThis is the primary routing input that identifies which handler should process the task\nand contains all the information needed to create a Task instance from a NamedTask template",
        "required": [
          "name",
          "namespace",
          "version",
          "context",
          "initiator",
          "source_system",
          "reason",
          "tags",
          "requested_at",
          "correlation_id"
        ],
        "properties": {
          "context": {
            "description": "Context data required for task execution (Rails: context)"
          },
          "correlation_id": {
            "type": "string",
            "format": "uuid",
            "description": "Correlation ID for distributed tracing (auto-generated if not provided)\nTAS-29: Enables end-to-end request tracking across orchestration and workers"
          },
          "idempotency_key": {
            "type": [
              "string",
              "null"
            ],
            "description": "TAS-154: Optional caller-provided idempotency key.\n\nWhen provided, this key is used to compute the task's identity_hash,\noverriding the named task's default identity strategy.\n\nUse cases:\n- Override STRICT strategy with a custom key\n- Provide required key for CALLER_PROVIDED strategy\n- Time-bucketed keys for windowed deduplication (e.g., `\"job-2026-01-20-09\"`)\n\nThe key is combined with the named_task_uuid to prevent collisions across\ndifferent named tasks."
          },
          "initiator": {
            "type": "string",
            "description": "The entity or system that initiated this task request (Rails: initiator)"
          },
          "name": {
            "type": "string",
            "description": "The name of the task to be performed (Rails: name)"
          },
          "namespace": {
            "type": "string",
            "description": "The namespace of the task to be performed (Rails: namespace, default: \"default\")"
          },
          "options": {
            "type": [
              "object",
              "null"
            ],
            "description": "Custom options that override task template defaults (Rust extension)",
            "additionalProperties": {},
            "propertyNames": {
              "type": "string"
            }
          },
          "parent_correlation_id": {
            "type": [
              "string",
              "null"
            ],
            "format": "uuid",
            "description": "Optional parent correlation ID for nested/chained workflow relationships\nTAS-29: Enables tracking of workflow hierarchies"
          },
          "priority": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int32",
            "description": "Priority for task execution (higher values = higher priority). Default: 0"
          },
          "reason": {
            "type": "string",
            "description": "The reason why this task was requested (Rails: reason)"
          },
          "requested_at": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when the task was initially requested (Rails: requested_at)"
          },
          "source_system": {
            "type": "string",
            "description": "The system from which this task originated (Rails: source_system)"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Tags associated with this task for categorization or filtering (Rails: tags)"
          },
          "version": {
            "type": "string",
            "description": "The version of the task to be performed (Rails: version, default: \"0.1.0\")"
          }
        }
      },
      "TaskResponse": {
        "type": "object",
        "description": "Task details response with execution context and step readiness information",
        "required": [
          "task_uuid",
          "name",
          "namespace",
          "version",
          "status",
          "created_at",
          "updated_at",
          "context",
          "initiator",
          "source_system",
          "reason",
          "correlation_id",
          "total_steps",
          "pending_steps",
          "in_progress_steps",
          "completed_steps",
          "failed_steps",
          "ready_steps",
          "execution_status",
          "recommended_action",
          "completion_percentage",
          "health_status",
          "steps"
        ],
        "properties": {
          "completed_at": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time"
          },
          "completed_steps": {
            "type": "integer",
            "format": "int64"
          },
          "completion_percentage": {
            "type": "number",
            "format": "double"
          },
          "context": {},
          "correlation_id": {
            "type": "string",
            "format": "uuid"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "execution_status": {
            "type": "string"
          },
          "failed_steps": {
            "type": "integer",
            "format": "int64"
          },
          "health_status": {
            "type": "string"
          },
          "in_progress_steps": {
            "type": "integer",
            "format": "int64"
          },
          "initiator": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "namespace": {
            "type": "string"
          },
          "parent_correlation_id": {
            "type": [
              "string",
              "null"
            ],
            "format": "uuid"
          },
          "pending_steps": {
            "type": "integer",
            "format": "int64"
          },
          "priority": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int32"
          },
          "ready_steps": {
            "type": "integer",
            "format": "int64"
          },
          "reason": {
            "type": "string"
          },
          "recommended_action": {
            "type": "string"
          },
          "source_system": {
            "type": "string"
          },
          "status": {
            "type": "string"
          },
          "steps": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/StepReadinessStatus"
            }
          },
          "tags": {
            "type": [
              "array",
              "null"
            ],
            "items": {
              "type": "string"
            }
          },
          "task_uuid": {
            "type": "string"
          },
          "total_steps": {
            "type": "integer",
            "format": "int64"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          },
          "version": {
            "type": "string"
          }
        }
      },
      "TemplateDetail": {
        "type": "object",
        "description": "Detailed information about a single template\n\nReturned when fetching a specific template by namespace/name/version.",
        "required": [
          "name",
          "namespace",
          "version",
          "configuration",
          "steps"
        ],
        "properties": {
          "configuration": {
            "type": "object",
            "description": "Template configuration (JSON)"
          },
          "description": {
            "type": [
              "string",
              "null"
            ],
            "description": "Optional description"
          },
          "name": {
            "type": "string",
            "description": "Template name"
          },
          "namespace": {
            "type": "string",
            "description": "Namespace the template belongs to"
          },
          "steps": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/StepDefinition"
            },
            "description": "Step definitions for this template"
          },
          "version": {
            "type": "string",
            "description": "Template version"
          }
        }
      },
      "TemplateListResponse": {
        "type": "object",
        "description": "Response for template listing endpoint\n\nProvides an overview of all available templates, optionally filtered by namespace.",
        "required": [
          "namespaces",
          "templates",
          "total_count"
        ],
        "properties": {
          "namespaces": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/NamespaceSummary"
            },
            "description": "Summary of available namespaces"
          },
          "templates": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/TemplateSummary"
            },
            "description": "List of templates (optionally filtered)"
          },
          "total_count": {
            "type": "integer",
            "description": "Total number of templates (before filtering)",
            "minimum": 0
          }
        }
      },
      "TemplateSummary": {
        "type": "object",
        "description": "Summary information about a template\n\nUsed in list responses to provide an overview of available templates.",
        "required": [
          "name",
          "namespace",
          "version",
          "step_count"
        ],
        "properties": {
          "description": {
            "type": [
              "string",
              "null"
            ],
            "description": "Optional description"
          },
          "name": {
            "type": "string",
            "description": "Template name"
          },
          "namespace": {
            "type": "string",
            "description": "Namespace the template belongs to"
          },
          "step_count": {
            "type": "integer",
            "description": "Number of steps in the template",
            "minimum": 0
          },
          "version": {
            "type": "string",
            "description": "Template version"
          }
        }
      },
      "UpdateInvestigationRequest": {
        "type": "object",
        "description": "Request body for updating DLQ investigation status",
        "properties": {
          "metadata": {
            "description": "Additional metadata (optional)"
          },
          "resolution_notes": {
            "type": [
              "string",
              "null"
            ],
            "description": "Investigation notes (optional)"
          },
          "resolution_status": {
            "oneOf": [
              {
                "type": "null"
              },
              {
                "$ref": "#/components/schemas/DlqResolutionStatus",
                "description": "New resolution status (optional)"
              }
            ]
          },
          "resolved_by": {
            "type": [
              "string",
              "null"
            ],
            "description": "Who resolved the investigation (optional)"
          }
        }
      },
      "UpdateInvestigationResponse": {
        "type": "object",
        "description": "Response for update investigation endpoint",
        "required": [
          "success",
          "message",
          "dlq_entry_uuid"
        ],
        "properties": {
          "dlq_entry_uuid": {
            "type": "string",
            "format": "uuid"
          },
          "message": {
            "type": "string"
          },
          "success": {
            "type": "boolean"
          }
        }
      }
    },
    "securitySchemes": {
      "api_key_auth": {
        "type": "apiKey",
        "in": "header",
        "name": "X-API-Key"
      },
      "bearer_auth": {
        "type": "http",
        "scheme": "bearer"
      }
    }
  },
  "tags": [
    {
      "name": "tasks",
      "description": "Task management operations"
    },
    {
      "name": "workflow_steps",
      "description": "Workflow step operations"
    },
    {
      "name": "health",
      "description": "Health check and monitoring"
    },
    {
      "name": "analytics",
      "description": "Performance analytics and metrics"
    },
    {
      "name": "templates",
      "description": "Template discovery and information"
    },
    {
      "name": "dlq",
      "description": "Dead Letter Queue investigation and monitoring"
    },
    {
      "name": "config",
      "description": "Runtime configuration observability (safe fields only)"
    }
  ]
}
