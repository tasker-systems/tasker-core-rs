# TaskTemplate Configuration - Ruby Implementation
#
# Tree Workflow Pattern with Ruby Step Handlers via FFI
# Demonstrates complex hierarchical tree structure with multiple branches and convergence
#
# Template: tree_workflow/hierarchical_tree:1.0.0
# Implementation: Ruby FFI with tasker-worker-rb
# Updated: 2025-09-24 (Fixed Template Format)
#
# Tree Pattern (8 steps):
# 1. Root: Square input (6 → 36)
# 2. Branch Left: Square root result (36 → 1,296)
# 3. Branch Right: Square root result (36 → 1,296)
# 4. Leaf D: Square left branch (1,296 → 1,679,616)
# 5. Leaf E: Square left branch (1,296 → 1,679,616)
# 6. Leaf F: Square right branch (1,296 → 1,679,616)
# 7. Leaf G: Square right branch (1,296 → 1,679,616)
# 8. Final Convergence: Multiply all 4 leaves and square
# Final result: input^32
#
---
name: hierarchical_tree
namespace_name: tree_workflow
version: 1.0.0
description: "Complex hierarchical tree workflow: root → branches → leaves → convergence (input^32)"
metadata:
  author: Ruby FFI Implementation
  tags:
    - namespace:tree_workflow
    - pattern:hierarchical_tree
    - dependencies:complex_multi_parent
    - implementation:ruby_ffi
    - language:ruby
    - type_safety:runtime
    - parallelism:multi_branch
    - convergence:four_way
  documentation_url:
  created_at: "2025-09-24T00:00:00Z"
  updated_at: "2025-09-24T00:00:00Z"
  notes: "Ruby FFI implementation with complex hierarchical dependency resolution"
task_handler:
  callable: TreeWorkflow::TreeWorkflowHandler
  initialization:
    input_validation:
      required_fields:
        - even_number
      even_number_constraint: must_be_even
      value_range:
        min: 2
        max: 100
    expected_results:
      tree_root: "input²"
      tree_branch_left: "(input²)²"
      tree_branch_right: "(input²)²"
      tree_leaf_d: "((input²)²)²"
      tree_leaf_e: "((input²)²)²"
      tree_leaf_f: "((input²)²)²"
      tree_leaf_g: "((input²)²)²"
      tree_final_convergence: "(((input²)²)² × ((input²)²)² × ((input²)²)² × ((input²)²)²)²"
      final_pattern: "input^32"
system_dependencies:
  primary: default
  secondary: []
domain_events: []
input_schema:
  type: object
  required:
    - even_number
  properties:
    even_number:
      type: integer
      minimum: 2
      maximum: 100
      description: "Even number for hierarchical tree calculation"
steps:
  - name: tree_root
    description: "Tree root: Square the input even number"
    handler:
      callable: TreeWorkflow::StepHandlers::TreeRootHandler
      initialization:
        operation: square
        step_type: root
        description: "Root of the tree: square the input"
        branches:
          - tree_branch_left
          - tree_branch_right
    system_dependency:
    dependencies: []
    retry:
      retryable: true
      limit: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: tree_branch_left
    description: "Left branch: Square the root result"
    handler:
      callable: TreeWorkflow::StepHandlers::TreeBranchLeftHandler
      initialization:
        operation: square
        step_type: branch
        branch_side: left
        description: "Left branch: square the root result"
        leaves:
          - tree_leaf_d
          - tree_leaf_e
    system_dependency:
    dependencies:
      - tree_root
    retry:
      retryable: true
      limit: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: tree_branch_right
    description: "Right branch: Square the root result"
    handler:
      callable: TreeWorkflow::StepHandlers::TreeBranchRightHandler
      initialization:
        operation: square
        step_type: branch
        branch_side: right
        description: "Right branch: square the root result"
        leaves:
          - tree_leaf_f
          - tree_leaf_g
    system_dependency:
    dependencies:
      - tree_root
    retry:
      retryable: true
      limit: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: tree_leaf_d
    description: "Leaf D: Square the left branch result"
    handler:
      callable: TreeWorkflow::StepHandlers::TreeLeafDHandler
      initialization:
        operation: square
        step_type: leaf
        leaf_id: d
        parent_branch: left
        description: "Leaf D: square left branch result"
    system_dependency:
    dependencies:
      - tree_branch_left
    retry:
      retryable: true
      limit: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: tree_leaf_e
    description: "Leaf E: Square the left branch result"
    handler:
      callable: TreeWorkflow::StepHandlers::TreeLeafEHandler
      initialization:
        operation: square
        step_type: leaf
        leaf_id: e
        parent_branch: left
        description: "Leaf E: square left branch result"
    system_dependency:
    dependencies:
      - tree_branch_left
    retry:
      retryable: true
      limit: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: tree_leaf_f
    description: "Leaf F: Square the right branch result"
    handler:
      callable: TreeWorkflow::StepHandlers::TreeLeafFHandler
      initialization:
        operation: square
        step_type: leaf
        leaf_id: f
        parent_branch: right
        description: "Leaf F: square right branch result"
    system_dependency:
    dependencies:
      - tree_branch_right
    retry:
      retryable: true
      limit: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: tree_leaf_g
    description: "Leaf G: Square the right branch result"
    handler:
      callable: TreeWorkflow::StepHandlers::TreeLeafGHandler
      initialization:
        operation: square
        step_type: leaf
        leaf_id: g
        parent_branch: right
        description: "Leaf G: square right branch result"
    system_dependency:
    dependencies:
      - tree_branch_right
    retry:
      retryable: true
      limit: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: tree_final_convergence
    description: "Final convergence: Multiply all 4 leaf results and square"
    handler:
      callable: TreeWorkflow::StepHandlers::TreeFinalConvergenceHandler
      initialization:
        operation: multiply_all_and_square
        step_type: final_convergence
        description: "Converge all 4 leaves: multiply all then square"
        convergence_pattern: "((leaf_d × leaf_e × leaf_f × leaf_g)²)"
        final_result: "input^32"
        leaf_count: 4
    system_dependency:
    dependencies:
      - tree_leaf_d
      - tree_leaf_e
      - tree_leaf_f
      - tree_leaf_g
    retry:
      retryable: true
      limit: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 45
    publishes_events: []
environments:
  test:
    steps:
      - name: tree_root
        timeout_seconds: 10
        retry:
          limit: 2
      - name: tree_branch_left
        timeout_seconds: 10
        retry:
          limit: 2
      - name: tree_branch_right
        timeout_seconds: 10
        retry:
          limit: 2
      - name: tree_leaf_d
        timeout_seconds: 10
        retry:
          limit: 2
      - name: tree_leaf_e
        timeout_seconds: 10
        retry:
          limit: 2
      - name: tree_leaf_f
        timeout_seconds: 10
        retry:
          limit: 2
      - name: tree_leaf_g
        timeout_seconds: 10
        retry:
          limit: 2
      - name: tree_final_convergence
        timeout_seconds: 20
        retry:
          limit: 2