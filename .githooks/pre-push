#!/bin/bash
# Pre-push hook for comprehensive multi-workspace testing
# Runs full test suite and documentation builds before pushing to remote

set -e

# Source the shared workspace utilities
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/lib/workspace-utils.sh"

echo "ðŸš€ Running pre-push hooks..."

# Check if cargo is available
if ! check_cargo_available; then
    exit 1
fi

# Run comprehensive validation across all workspaces
if ! validate_all_workspaces "pre-push"; then
    echo ""
    echo "ðŸ’¡ Fix the issues above before pushing."
    echo "   Common fixes:"
    echo "   - Format code: .githooks/lib/workspace-utils.sh && auto_fix_formatting"
    echo "   - Fix clippy: cargo clippy --fix --allow-dirty (in each workspace)"
    echo "   - Fix tests: cargo test (in each workspace)"
    exit 1
fi

echo "ðŸŽ‰ All pre-push checks passed! Safe to push."