#!/bin/bash
# Pre-commit hook for multi-workspace Rust code quality
# Ensures code is formatted and passes clippy checks before commit

set -e

# Source the shared workspace utilities
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/lib/workspace-utils.sh"

echo "ðŸ”§ Running pre-commit hooks..."

# Check if cargo is available
if ! check_cargo_available; then
    exit 1
fi

# Run pre-commit validation across all workspaces
if ! validate_all_workspaces "pre-commit"; then
    echo ""
    echo "ðŸ’¡ To auto-fix formatting issues, run:"
    echo "   .githooks/lib/workspace-utils.sh && auto_fix_formatting"
    echo ""
    echo "   Then stage and commit your changes:"
    echo "   git add . && git commit"
    exit 1
fi

echo "ðŸŽ‰ All pre-commit checks passed!"