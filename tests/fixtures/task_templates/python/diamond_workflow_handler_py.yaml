# TaskTemplate Configuration - Python Implementation
#
# Diamond Workflow Pattern with Python Step Handlers via FFI (PyO3)
# Demonstrates parallel execution followed by convergence using Python handlers called from Rust
#
# Template: diamond_workflow/parallel_computation_py:1.0.0
# Implementation: Python FFI with tasker-worker-py (PyO3)
# Updated: 2025-12-13
#
# Diamond Pattern:
# 1. Start: Square the initial even number (6 -> 36)
# 2. Branch B (Left): Add 25 to squared result (36 + 25 = 61)
# 3. Branch C (Right): Multiply squared result by 2 (36 * 2 = 72)
# 4. End: Average both branch results ((61 + 72) / 2 = 66.5)
#
---
name: parallel_computation_py
namespace_name: diamond_workflow_py
version: 1.0.0
description: "Diamond pattern with parallel branches: square -> (add, multiply) -> average (Python)"
metadata:
  author: Python FFI Implementation
  tags:
    - namespace:diamond_workflow_py
    - pattern:diamond
    - dependencies:parallel_convergence
    - implementation:python_ffi
    - language:python
    - type_safety:runtime
    - parallelism:branch_execution
  documentation_url:
  created_at: "2025-12-13T00:00:00Z"
  updated_at: "2025-12-13T00:00:00Z"
  notes: "Python FFI implementation with parallel branch processing and convergence logic"
task_handler:
  callable: diamond_workflow.DiamondWorkflowHandler
  initialization:
    input_validation:
      required_fields:
        - even_number
      even_number_constraint: must_be_even
      value_range:
        min: 2
        max: 100
    expected_results:
      diamond_start_py: "input**2"
      diamond_branch_b_py: "input**2 + 25"
      diamond_branch_c_py: "input**2 * 2"
      diamond_end_py: "((input**2 + 25) + (input**2 * 2)) / 2"
system_dependencies:
  primary: default
  secondary: []
domain_events: []
input_schema:
  type: object
  required:
    - even_number
  properties:
    even_number:
      type: integer
      minimum: 2
      maximum: 100
      description: "Even number for diamond pattern calculation"
steps:
  - name: diamond_start_py
    description: "Square the even number (initial step)"
    handler:
      callable: diamond_workflow.step_handlers.DiamondStartHandler
      initialization:
        operation: square
        description: "Square the input number (n**2)"
    system_dependency:
    dependencies: []
    retry:
      retryable: true
      max_attempts: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: diamond_branch_b_py
    description: "Add constant (parallel branch B)"
    handler:
      callable: diamond_workflow.step_handlers.DiamondBranchBHandler
      initialization:
        operation: add
        constant: 25
        description: "Add 25 to the squared result"
    system_dependency:
    dependencies:
      - diamond_start_py
    retry:
      retryable: true
      max_attempts: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: diamond_branch_c_py
    description: "Multiply by factor (parallel branch C)"
    handler:
      callable: diamond_workflow.step_handlers.DiamondBranchCHandler
      initialization:
        operation: multiply
        factor: 2
        description: "Multiply the squared result by 2"
    system_dependency:
    dependencies:
      - diamond_start_py
    retry:
      retryable: true
      max_attempts: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
  - name: diamond_end_py
    description: "Average results from both branches (convergence)"
    handler:
      callable: diamond_workflow.step_handlers.DiamondEndHandler
      initialization:
        operation: average
        description: "Calculate average of both branch results"
    system_dependency:
    dependencies:
      - diamond_branch_b_py
      - diamond_branch_c_py
    retry:
      retryable: true
      max_attempts: 3
      backoff: exponential
      backoff_base_ms: 1000
      max_backoff_ms: 30000
    timeout_seconds: 30
    publishes_events: []
environments:
  test:
    steps:
      - name: diamond_start_py
        timeout_seconds: 10
        retry:
          max_attempts: 2
      - name: diamond_branch_b_py
        timeout_seconds: 10
        retry:
          max_attempts: 2
      - name: diamond_branch_c_py
        timeout_seconds: 10
        retry:
          max_attempts: 2
      - name: diamond_end_py
        timeout_seconds: 10
        retry:
          max_attempts: 2
