name: CI Pipeline

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  docker-build:
    uses: ./.github/workflows/build-docker-images.yml

  code-quality:
    needs: docker-build
    uses: ./.github/workflows/code-quality.yml
    with:
      postgres-image: ${{ needs.docker-build.outputs.postgres-image }}

  unit-tests:
    needs: docker-build
    uses: ./.github/workflows/test-unit.yml
    with:
      postgres-image: ${{ needs.docker-build.outputs.postgres-image }}

  integration-tests:
    needs: [code-quality, unit-tests]
    uses: ./.github/workflows/test-integration.yml

  ci-success:
    needs: [integration-tests]
    uses: ./.github/workflows/ci-success.yml
