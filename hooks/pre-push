#!/bin/bash
# Pre-push hook for code quality validation
# Validates documentation and runs clippy checks before pushing to remote
# Tests are run manually and CI will catch any issues

set -e

echo "🚀 Running pre-push hooks..."

# Check if cargo is available
if ! command -v cargo &> /dev/null; then
    echo "❌ Error: cargo is not available. Please install Rust."
    exit 1
fi

echo "📚 Checking documentation builds..."
if ! SQLX_OFFLINE=true cargo doc --no-deps --document-private-items; then
    echo "❌ Documentation build failed. Please fix documentation issues."
    exit 1
fi
echo "✅ Documentation builds successfully"

echo "🔍 Running clippy with all features..."
if ! SQLX_OFFLINE=true cargo clippy --all-targets --all-features -- -D warnings; then
    echo "❌ Clippy found issues. Please fix before pushing."
    exit 1
fi
echo "✅ Clippy checks passed"

echo "🎉 All pre-push checks passed! Safe to push."
